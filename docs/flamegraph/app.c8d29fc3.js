function e(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},n={},o=r.parcelRequirea690;null==o&&((o=function(e){if(e in i)return i[e].exports;if(e in n){var t=n[e];delete n[e];var r={id:e,exports:{}};return i[e]=r,t.call(r.exports,r,r.exports),r.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){n[e]=t},r.parcelRequirea690=o),o.register("hKhGL",(function(t,r){var i,n;e(t.exports,"register",(()=>i),(e=>i=e)),e(t.exports,"resolve",(()=>n),(e=>n=e));var o={};i=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)o[t[r]]=e[t[r]]},n=function(e){var t=o[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),o.register("l3kj8",(function(e,t){e.exports=import("./"+o("hKhGL").resolve("jcw0e")).then((()=>o("92x6n")))})),o.register("1wbBj",(function(e,t){e.exports=import("./"+o("hKhGL").resolve("H4mWn")).then((()=>o("eCNwS")))})),o.register("8LNmT",(function(e,t){e.exports=JSON.parse('{"name":"speedscope","version":"1.15.0","description":"","repository":"jlfwong/speedscope","main":"index.js","targets":{"main":false},"bin":{"speedscope":"./bin/cli.js"},"scripts":{"deploy":"./scripts/deploy.sh","prepack":"./scripts/build-release.sh","prettier":"prettier --write \'src/**/*.ts\' \'src/**/*.tsx\'","lint":"eslint \'src/**/*.ts\' \'src/**/*.tsx\'","jest":"./scripts/test-setup.sh && jest --runInBand","coverage":"npm run jest -- --coverage","typecheck":"tsc --noEmit","test":"./scripts/ci.sh","build":"parcel build assets/index.html assets/app.html assets/data/**/* --no-autoinstall --dist-dir ../../tail2-server/static/flamegraph --public-url /flamegraph","watch":"parcel watch assets/index.html assets/app.html assets/data/**/* --no-autoinstall --dist-dir ../../tail2-server/static/flamegraph --public-url /flamegraph"},"files":["bin/cli.js","dist/release/**","!*.map"],"browserslist":["last 2 Chrome versions","last 2 Firefox versions"],"author":"","license":"MIT","devDependencies":{"@types/jest":"22.2.3","@types/jszip":"3.1.4","@types/node":"14.0.1","@types/pako":"1.0.0","@typescript-eslint/eslint-plugin":"4.19.0","@typescript-eslint/parser":"4.19.0","acorn":"7.2.0","eslint":"6.0.0","eslint-plugin-prettier":"2.6.0","eslint-plugin-react-hooks":"4.0.2","jest":"24.3.0","jsverify":"0.8.3","jszip":"3.1.5","pako":"1.0.6","parcel":"^2.8.0","parcel-resolver-ignore":"^2.1.3","postcss":"^8.4.19","prettier":"2.0.4","protobufjs":"6.8.8","tailwindcss":"^3.1.6","ts-jest":"24.3.0","typescript":"4.2.3","typescript-json-schema":"0.42.0","uglify-es":"3.2.2","uint8array-json-parser":"0.0.2"},"jest":{"transform":{"^.+\\\\.tsx?$":"ts-jest"},"setupFilesAfterEnv":["./src/jest-setup.js"],"testRegex":"\\\\.test\\\\.tsx?$","collectCoverageFrom":["**/*.{ts,tsx}","!**/*.d.{ts,tsx}"],"moduleFileExtensions":["ts","tsx","js","jsx","json"]},"dependencies":{"@parcel/transformer-postcss":"^2.8.1","@tailwindcss/forms":"^0.5.3","aphrodite":"2.1.0","chart.js":"^4.0.1","chartjs-adapter-moment":"^1.0.1","open":"7.2.0","preact":"10.4.1","preact-transition-group":"^2.0.0","source-map":"0.6.1"},"parcelIgnore":["./app\\\\?profileURL=.+"]}')})),o("hKhGL").register(JSON.parse('{"lNlOQ":"app.c8d29fc3.js","jcw0e":"demangle-cpp.ff403f05.js","H4mWn":"source-map.f62d5ab4.js"}'));var s,a,l,c,h,u,f,d={},p=[],m=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord/i;function g(e,t){for(var r in t)e[r]=t[r];return e}function _(e){var t=e.parentNode;t&&t.removeChild(e)}function w(e,t,r){var i,n=arguments,o={};for(i in t)"key"!==i&&"ref"!==i&&(o[i]=t[i]);if(arguments.length>3)for(r=[r],i=3;i<arguments.length;i++)r.push(n[i]);if(null!=r&&(o.children=r),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===o[i]&&(o[i]=e.defaultProps[i]);return v(e,o,t&&t.key,t&&t.ref,null)}function v(e,t,r,i,n){var o={type:e,props:t,key:r,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:n};return null==n&&(o.__v=o),s.vnode&&s.vnode(o),o}function y(e){return e.children}function S(e,t){this.props=e,this.context=t}function x(e,t){if(null==t)return e.__?x(e.__,e.__.__k.indexOf(e)+1):null;for(var r;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e)return r.__e;return"function"==typeof e.type?x(e):null}function C(e){var t,r;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(r=e.__k[t])&&null!=r.__e){e.__e=e.__c.base=r.__e;break}return C(e)}}function R(e){(!e.__d&&(e.__d=!0)&&a.push(e)&&!l++||h!==s.debounceRendering)&&((h=s.debounceRendering)||c)(E)}function E(){for(var e;l=a.length;)e=a.sort((function(e,t){return e.__v.__b-t.__v.__b})),a=[],e.some((function(e){var t,r,i,n,o,s,a;e.__d&&(s=(o=(t=e).__v).__e,(a=t.__P)&&(r=[],(i=g({},o)).__v=i,n=P(a,o,i,t.__n,void 0!==a.ownerSVGElement,null,r,null==s?x(o):s),N(r,o),n!=s&&C(o)))}))}function b(e,t,r,i,n,o,s,a,l){var c,h,u,f,m,g,w,v=r&&r.__k||p,y=v.length;if(a==d&&(a=null!=o?o[0]:y?x(r,0):null),c=0,t.__k=T(t.__k,(function(r){if(null!=r){if(r.__=t,r.__b=t.__b+1,null===(u=v[c])||u&&r.key==u.key&&r.type===u.type)v[c]=void 0;else for(h=0;h<y;h++){if((u=v[h])&&r.key==u.key&&r.type===u.type){v[h]=void 0;break}u=null}if(f=P(e,r,u=u||d,i,n,o,s,a,l),(h=r.ref)&&u.ref!=h&&(w||(w=[]),u.ref&&w.push(u.ref,null,r),w.push(h,r.__c||f,r)),null!=f){var p;if(null==g&&(g=f),void 0!==r.__d)p=r.__d,r.__d=void 0;else if(o==u||f!=a||null==f.parentNode){e:if(null==a||a.parentNode!==e)e.appendChild(f),p=null;else{for(m=a,h=0;(m=m.nextSibling)&&h<y;h+=2)if(m==f)break e;e.insertBefore(f,a),p=a}"option"==t.type&&(e.value="")}a=void 0!==p?p:f.nextSibling,"function"==typeof t.type&&(t.__d=a)}else a&&u.__e==a&&a.parentNode!=e&&(a=x(u))}return c++,r})),t.__e=g,null!=o&&"function"!=typeof t.type)for(c=o.length;c--;)null!=o[c]&&_(o[c]);for(c=y;c--;)null!=v[c]&&I(v[c],v[c]);if(w)for(c=0;c<w.length;c++)O(w[c],w[++c],w[++c])}function T(e,t,r){if(null==r&&(r=[]),null==e||"boolean"==typeof e)t&&r.push(t(null));else if(Array.isArray(e))for(var i=0;i<e.length;i++)T(e[i],t,r);else r.push(t?t("string"==typeof e||"number"==typeof e?v(null,e,null,null,e):null!=e.__e||null!=e.__c?v(e.type,e.props,e.key,null,e.__v):e):e);return r}function A(e,t,r){"-"===t[0]?e.setProperty(t,r):e[t]="number"==typeof r&&!1===m.test(t)?r+"px":null==r?"":r}function L(e,t,r,i,n){var o,s,a,l,c;if(n?"className"===t&&(t="class"):"class"===t&&(t="className"),"style"===t)if(o=e.style,"string"==typeof r)o.cssText=r;else{if("string"==typeof i&&(o.cssText="",i=null),i)for(l in i)r&&l in r||A(o,l,"");if(r)for(c in r)i&&r[c]===i[c]||A(o,c,r[c])}else"o"===t[0]&&"n"===t[1]?(s=t!==(t=t.replace(/Capture$/,"")),a=t.toLowerCase(),t=(a in e?a:t).slice(2),r?(i||e.addEventListener(t,F,s),(e.l||(e.l={}))[t]=r):e.removeEventListener(t,F,s)):"list"!==t&&"tagName"!==t&&"form"!==t&&"type"!==t&&"size"!==t&&!n&&t in e?e[t]=null==r?"":r:"function"!=typeof r&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/^xlink:?/,""))?null==r||!1===r?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):null==r||!1===r&&!/^ar/.test(t)?e.removeAttribute(t):e.setAttribute(t,r))}function F(e){this.l[e.type](s.event?s.event(e):e)}function P(e,t,r,i,n,o,a,l,c){var h,u,f,m,_,w,v,x,C,R,E=t.type;if(void 0!==t.constructor)return null;(h=s.__b)&&h(t);try{e:if("function"==typeof E){if(x=t.props,C=(h=E.contextType)&&i[h.__c],R=h?C?C.props.value:h.__:i,r.__c?v=(u=t.__c=r.__c).__=u.__E:("prototype"in E&&E.prototype.render?t.__c=u=new E(x,R):(t.__c=u=new S(x,R),u.constructor=E,u.render=M),C&&C.sub(u),u.props=x,u.state||(u.state={}),u.context=R,u.__n=i,f=u.__d=!0,u.__h=[]),null==u.__s&&(u.__s=u.state),null!=E.getDerivedStateFromProps&&(u.__s==u.state&&(u.__s=g({},u.__s)),g(u.__s,E.getDerivedStateFromProps(x,u.__s))),m=u.props,_=u.state,f)null==E.getDerivedStateFromProps&&null!=u.componentWillMount&&u.componentWillMount(),null!=u.componentDidMount&&u.__h.push(u.componentDidMount);else{if(null==E.getDerivedStateFromProps&&x!==m&&null!=u.componentWillReceiveProps&&u.componentWillReceiveProps(x,R),!u.__e&&null!=u.shouldComponentUpdate&&!1===u.shouldComponentUpdate(x,u.__s,R)||t.__v===r.__v&&!u.__){for(u.props=x,u.state=u.__s,t.__v!==r.__v&&(u.__d=!1),u.__v=t,t.__e=r.__e,t.__k=r.__k,u.__h.length&&a.push(u),h=0;h<t.__k.length;h++)t.__k[h]&&(t.__k[h].__=t);break e}null!=u.componentWillUpdate&&u.componentWillUpdate(x,u.__s,R),null!=u.componentDidUpdate&&u.__h.push((function(){u.componentDidUpdate(m,_,w)}))}u.context=R,u.props=x,u.state=u.__s,(h=s.__r)&&h(t),u.__d=!1,u.__v=t,u.__P=e,h=u.render(u.props,u.state,u.context),t.__k=null!=h&&h.type==y&&null==h.key?h.props.children:Array.isArray(h)?h:[h],null!=u.getChildContext&&(i=g(g({},i),u.getChildContext())),f||null==u.getSnapshotBeforeUpdate||(w=u.getSnapshotBeforeUpdate(m,_)),b(e,t,r,i,n,o,a,l,c),u.base=t.__e,u.__h.length&&a.push(u),v&&(u.__E=u.__=null),u.__e=!1}else null==o&&t.__v===r.__v?(t.__k=r.__k,t.__e=r.__e):t.__e=function(e,t,r,i,n,o,s,a){var l,c,h,u,f,m=r.props,g=t.props;if(n="svg"===t.type||n,null!=o)for(l=0;l<o.length;l++)if(null!=(c=o[l])&&((null===t.type?3===c.nodeType:c.localName===t.type)||e==c)){e=c,o[l]=null;break}if(null==e){if(null===t.type)return document.createTextNode(g);e=n?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type,g.is&&{is:g.is}),o=null,a=!1}if(null===t.type)m!==g&&e.data!=g&&(e.data=g);else{if(null!=o&&(o=p.slice.call(e.childNodes)),h=(m=r.props||d).dangerouslySetInnerHTML,u=g.dangerouslySetInnerHTML,!a){if(m===d)for(m={},f=0;f<e.attributes.length;f++)m[e.attributes[f].name]=e.attributes[f].value;(u||h)&&(u&&h&&u.__html==h.__html||(e.innerHTML=u&&u.__html||""))}(function(e,t,r,i,n){var o;for(o in r)"children"===o||"key"===o||o in t||L(e,o,null,r[o],i);for(o in t)n&&"function"!=typeof t[o]||"children"===o||"key"===o||"value"===o||"checked"===o||r[o]===t[o]||L(e,o,t[o],r[o],i)})(e,g,m,n,a),u?t.__k=[]:(t.__k=t.props.children,b(e,t,r,i,"foreignObject"!==t.type&&n,o,s,d,a)),a||("value"in g&&void 0!==(l=g.value)&&l!==e.value&&L(e,"value",l,m.value,!1),"checked"in g&&void 0!==(l=g.checked)&&l!==e.checked&&L(e,"checked",l,m.checked,!1))}return e}(r.__e,t,r,i,n,o,a,c);(h=s.diffed)&&h(t)}catch(e){t.__v=null,s.__e(e,t,r)}return t.__e}function N(e,t){s.__c&&s.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){s.__e(e,t.__v)}}))}function O(e,t,r){try{"function"==typeof e?e(t):e.current=t}catch(e){s.__e(e,r)}}function I(e,t,r){var i,n,o;if(s.unmount&&s.unmount(e),(i=e.ref)&&(i.current&&i.current!==e.__e||O(i,null,t)),r||"function"==typeof e.type||(r=null!=(n=e.__e)),e.__e=e.__d=void 0,null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){s.__e(e,t)}i.base=i.__P=null}if(i=e.__k)for(o=0;o<i.length;o++)i[o]&&I(i[o],t,r);null!=n&&_(n)}function M(e,t,r){return this.constructor(e,r)}function V(e,t,r){var i,n,o;s.__&&s.__(e,t),n=(i=r===u)?null:r&&r.__k||t.__k,e=w(y,null,[e]),o=[],P(t,(i?t:r||t).__k=e,n||d,d,void 0!==t.ownerSVGElement,r&&!i?[r]:n?null:p.slice.call(t.childNodes),o,r||d,i),N(o,e)}function k(e){var t={},r={__c:"__cC"+f++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var i,n=this;return this.getChildContext||(i=[],this.getChildContext=function(){return t[r.__c]=n,t},this.shouldComponentUpdate=function(e){n.props.value!==e.value&&i.some((function(t){t.context=e.value,R(t)}))},this.sub=function(e){i.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){i.splice(i.indexOf(e),1),t&&t.call(e)}}),e.children}};return r.Consumer.contextType=r,r.Provider.__=r,r}function W(e){return e[e.length-1]||null}function B(e,t){e.sort((function(e,r){const i=t(e),n=t(r);return i<n?-1:i>n?1:0}))}s={__e:function(e,t){for(var r,i;t=t.__;)if((r=t.__c)&&!r.__)try{if(r.constructor&&null!=r.constructor.getDerivedStateFromError&&(i=!0,r.setState(r.constructor.getDerivedStateFromError(e))),null!=r.componentDidCatch&&(i=!0,r.componentDidCatch(e)),i)return R(r.__E=r)}catch(t){e=t}throw e}},S.prototype.setState=function(e,t){var r;r=this.__s!==this.state?this.__s:this.__s=g({},this.state),"function"==typeof e&&(e=e(r,this.props)),e&&g(r,e),null!=e&&this.__v&&(t&&this.__h.push(t),R(this))},S.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),R(this))},S.prototype.render=y,a=[],l=0,c="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,u=d,f=0;class H{map=new Map;getOrInsert(e){const t=e.key,r=this.map.get(t);return r||(this.map.set(t,e),e)}forEach(e){this.map.forEach(e)}[Symbol.iterator](){return this.map.values()}}function D(e){let t=`${e.toFixed(0)}%`;return 100===e?t="100%":e>99?t=">99%":e<.01?t="<0.01%":e<1?t=`${e.toFixed(2)}%`:e<10&&(t=`${e.toFixed(1)}%`),t}function z(e){return 2*Math.abs(function(e){return e-Math.floor(e)}(e)-.5)-1}function G(e,t,r,i,n=1){for(console.assert(!isNaN(n)&&!isNaN(i));;){if(t-e<=n)return[e,t];const o=(t+e)/2;r(o)<i?e=o:t=o}}function U(...e){}function j(e,t){for(let r in e)if(e[r]!==t[r])return!1;for(let r in t)if(e[r]!==t[r])return!1;return!0}function $(e){let t=null;return r=>{let i;return null==t?(i=e(r),t={args:r,result:i},i):(j(t.args,r)||(t.args=r,t.result=e(r)),t.result)}}function K(e){let t=null;return r=>{let i;return null==t?(i=e(r),t={args:r,result:i},i):(t.args===r||(t.args=r,t.result=e(r)),t.result)}}!function(e){let t=null}((()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=new Map;for(let r=0;r<e.length;r++)t.set(e.charAt(r),r);return t.set("=",-1),t}));class Y{constructor(e){this.data=e,this.prev=null,this.next=null}}class X{head=null;tail=null;size=0;constructor(){}getHead(){return this.head}getTail(){return this.tail}getSize(){return this.size}append(e){this.tail?(this.tail.next=e,e.prev=this.tail,this.tail=e):this.head=this.tail=e,this.size++}prepend(e){return this.head?(this.head.prev=e,e.next=this.head,this.head=e):this.head=this.tail=e,this.size++,e}pop(){if(this.tail){const e=this.tail;return e.prev?(this.tail=e.prev,this.tail.next=null):this.head=this.tail=null,this.size--,e.prev=null,e}return null}dequeue(){if(this.head){const e=this.head;return e.next?(this.head=e.next,this.head.prev=null):this.head=this.tail=null,this.size--,e.next=null,e}return null}remove(e){null==e.prev?this.dequeue():null==e.next?this.pop():(e.next.prev=e.prev,e.prev.next=e.next,e.next=null,e.prev=null,this.size--)}}class q{constructor(e){this.capacity=e,this.list=new X,this.map=new Map}has(e){return this.map.has(e)}get(e){const t=this.map.get(e);return t?(this.list.remove(t.listNode),this.list.prepend(t.listNode),t?t.value:null):null}getSize(){return this.list.getSize()}getCapacity(){return this.capacity}insert(e,t){const r=this.map.get(e);for(r&&this.list.remove(r.listNode);this.list.getSize()>=this.capacity;)this.map.delete(this.list.pop().data);const i=this.list.prepend(new Y(e));this.map.set(e,{value:t,listNode:i})}getOrInsert(e,t){let r=this.get(e);return null==r&&(r=t(e),this.insert(e,r)),r}removeLRU(){const e=this.list.pop();if(!e)return null;const t=e.data,r=this.map.get(t).value;return this.map.delete(t),[t,r]}clear(){this.list=new X,this.map=new Map}}function Z(e,t,r){return e<t?t:e>r?r:e}class Q{constructor(e,t){this.x=e,this.y=t}withX(e){return new Q(e,this.y)}withY(e){return new Q(this.x,e)}plus(e){return new Q(this.x+e.x,this.y+e.y)}minus(e){return new Q(this.x-e.x,this.y-e.y)}times(e){return new Q(this.x*e,this.y*e)}timesPointwise(e){return new Q(this.x*e.x,this.y*e.y)}dividedByPointwise(e){return new Q(this.x/e.x,this.y/e.y)}dot(e){return this.x*e.x+this.y*e.y}equals(e){return this.x===e.x&&this.y===e.y}approxEquals(e,t=1e-9){return Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}abs(){return new Q(Math.abs(this.x),Math.abs(this.y))}static min(e,t){return new Q(Math.min(e.x,t.x),Math.min(e.y,t.y))}static max(e,t){return new Q(Math.max(e.x,t.x),Math.max(e.y,t.y))}static clamp(e,t,r){return new Q(Z(e.x,t.x,r.x),Z(e.y,t.y,r.y))}static zero=new Q(0,0);static unit=new Q(1,1);flatten(){return[this.x,this.y]}}class J{constructor(e=1,t=0,r=0,i=0,n=1,o=0){this.m00=e,this.m01=t,this.m02=r,this.m10=i,this.m11=n,this.m12=o}withScale(e){let{m00:t,m01:r,m02:i,m10:n,m11:o,m12:s}=this;return t=e.x,o=e.y,new J(t,r,i,n,o,s)}static withScale(e){return(new J).withScale(e)}scaledBy(e){return J.withScale(e).times(this)}getScale(){return new Q(this.m00,this.m11)}withTranslation(e){let{m00:t,m01:r,m02:i,m10:n,m11:o,m12:s}=this;return i=e.x,s=e.y,new J(t,r,i,n,o,s)}static withTranslation(e){return(new J).withTranslation(e)}getTranslation(){return new Q(this.m02,this.m12)}translatedBy(e){return J.withTranslation(e).times(this)}static betweenRects(e,t){return J.withTranslation(e.origin.times(-1)).scaledBy(new Q(t.size.x/e.size.x,t.size.y/e.size.y)).translatedBy(t.origin)}times(e){const t=this.m00*e.m00+this.m01*e.m10,r=this.m00*e.m01+this.m01*e.m11,i=this.m00*e.m02+this.m01*e.m12+this.m02,n=this.m10*e.m00+this.m11*e.m10,o=this.m10*e.m01+this.m11*e.m11,s=this.m10*e.m02+this.m11*e.m12+this.m12;return new J(t,r,i,n,o,s)}equals(e){return this.m00==e.m00&&this.m01==e.m01&&this.m02==e.m02&&this.m10==e.m10&&this.m11==e.m11&&this.m12==e.m12}approxEquals(e,t=1e-9){return Math.abs(this.m00-e.m00)<t&&Math.abs(this.m01-e.m01)<t&&Math.abs(this.m02-e.m02)<t&&Math.abs(this.m10-e.m10)<t&&Math.abs(this.m11-e.m11)<t&&Math.abs(this.m12-e.m12)<t}timesScalar(e){const{m00:t,m01:r,m02:i,m10:n,m11:o,m12:s}=this;return new J(e*t,e*r,e*i,e*n,e*o,e*s)}det(){const{m00:e,m01:t,m02:r,m10:i,m11:n,m12:o}=this;return e*(1*n-0*o)-t*(1*i-0*o)+r*(0*i-0*n)}adj(){const{m00:e,m01:t,m02:r,m10:i,m11:n,m12:o}=this;return new J(+(1*n-0*o),-(1*t-0*r),+(t*o-r*n),-(1*i-0*o),+(1*e-0*r),-(e*o-r*i))}inverted(){const e=this.det();if(0===e)return null;return this.adj().timesScalar(1/e)}transformVector(e){return new Q(e.x*this.m00+e.y*this.m01,e.x*this.m10+e.y*this.m11)}inverseTransformVector(e){const t=this.inverted();return t?t.transformVector(e):null}transformPosition(e){return new Q(e.x*this.m00+e.y*this.m01+this.m02,e.x*this.m10+e.y*this.m11+this.m12)}inverseTransformPosition(e){const t=this.inverted();return t?t.transformPosition(e):null}transformRect(e){const t=this.transformVector(e.size),r=this.transformPosition(e.origin);return t.x<0&&t.y<0?new ee(r.plus(t),t.abs()):t.x<0?new ee(r.withX(r.x+t.x),t.abs()):t.y<0?new ee(r.withY(r.y+t.y),t.abs()):new ee(r,t)}inverseTransformRect(e){const t=this.inverted();return t?t.transformRect(e):null}flatten(){return[this.m00,this.m10,0,this.m01,this.m11,0,this.m02,this.m12,1]}}class ee{constructor(e,t){this.origin=e,this.size=t}isEmpty(){return 0==this.width()||0==this.height()}width(){return this.size.x}height(){return this.size.y}left(){return this.origin.x}right(){return this.left()+this.width()}top(){return this.origin.y}bottom(){return this.top()+this.height()}topLeft(){return this.origin}topRight(){return this.origin.plus(new Q(this.width(),0))}bottomRight(){return this.origin.plus(this.size)}bottomLeft(){return this.origin.plus(new Q(0,this.height()))}withOrigin(e){return new ee(e,this.size)}withSize(e){return new ee(this.origin,e)}closestPointTo(e){return new Q(Z(e.x,this.left(),this.right()),Z(e.y,this.top(),this.bottom()))}distanceFrom(e){return e.minus(this.closestPointTo(e)).length()}contains(e){return 0===this.distanceFrom(e)}hasIntersectionWith(e){const t=Math.max(this.top(),e.top());if(Math.max(t,Math.min(this.bottom(),e.bottom()))-t==0)return!1;const r=Math.max(this.left(),e.left());return Math.max(r,Math.min(this.right(),e.right()))-r!=0}intersectWith(e){const t=Q.max(this.topLeft(),e.topLeft()),r=Q.max(t,Q.min(this.bottomRight(),e.bottomRight()));return new ee(t,r.minus(t))}equals(e){return this.origin.equals(e.origin)&&this.size.equals(e.size)}approxEquals(e){return this.origin.approxEquals(e.origin)&&this.size.approxEquals(e.size)}area(){return this.size.x*this.size.y}static empty=new ee(Q.zero,Q.zero);static unit=new ee(Q.zero,Q.unit);static NDC=new ee(new Q(-1,-1),new Q(2,2))}function te(e){0}let re,ie;function ne(e,t,r){let{m00:i,m01:n,m02:o,m10:s,m11:a,m12:l}=r;e.setUniformMat3(t,i,n,o,s,a,l,0,0,1)}function oe(e,t,r){e.setUniformVec2(t,r.x,r.y)}function se(e,t,r){e.setRenderTarget(t),e.setViewport(0,0,t.texture.width,t.texture.height),r(),e.setRenderTarget(null)}!function(e){e.Rect=class{constructor(e=0,t=0,r=0,i=0){this.x=e,this.y=t,this.width=r,this.height=i}set(e,t,r,i){this.x=e,this.y=t,this.width=r,this.height=i}equals(e){return this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height}};class t{constructor(e,t,r,i){this.redF=e,this.greenF=t,this.blueF=r,this.alphaF=i}equals(e){return this.redF===e.redF&&this.greenF===e.greenF&&this.blueF===e.blueF&&this.alphaF===e.alphaF}static TRANSPARENT=new t(0,0,0,0)}let r,i,n,o,s;e.Color=t,function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SOURCE_COLOR=2]="SOURCE_COLOR",e[e.TARGET_COLOR=3]="TARGET_COLOR",e[e.INVERSE_SOURCE_COLOR=4]="INVERSE_SOURCE_COLOR",e[e.INVERSE_TARGET_COLOR=5]="INVERSE_TARGET_COLOR",e[e.SOURCE_ALPHA=6]="SOURCE_ALPHA",e[e.TARGET_ALPHA=7]="TARGET_ALPHA",e[e.INVERSE_SOURCE_ALPHA=8]="INVERSE_SOURCE_ALPHA",e[e.INVERSE_TARGET_ALPHA=9]="INVERSE_TARGET_ALPHA",e[e.CONSTANT=10]="CONSTANT",e[e.INVERSE_CONSTANT=11]="INVERSE_CONSTANT"}(r=e.BlendOperation||(e.BlendOperation={})),function(e){e[e.TRIANGLES=0]="TRIANGLES",e[e.TRIANGLE_STRIP=1]="TRIANGLE_STRIP"}(i=e.Primitive||(e.Primitive={}));function a(e){return e==n.FLOAT?4:1}e.Context=class{setCopyBlendState(){this.setBlendState(r.ONE,r.ZERO)}setAddBlendState(){this.setBlendState(r.ONE,r.ONE)}setPremultipliedBlendState(){this.setBlendState(r.ONE,r.INVERSE_SOURCE_ALPHA)}setUnpremultipliedBlendState(){this.setBlendState(r.SOURCE_ALPHA,r.INVERSE_SOURCE_ALPHA)}resizeEventHandlers=new Set;addAfterResizeEventHandler(e){this.resizeEventHandlers.add(e)}removeAfterResizeEventHandler(e){this.resizeEventHandlers.delete(e)}},function(e){e[e.FLOAT=0]="FLOAT",e[e.BYTE=1]="BYTE"}(n=e.AttributeType||(e.AttributeType={})),e.attributeByteLength=a;class l{constructor(e,t,r,i){this.name=e,this.type=t,this.count=r,this.byteOffset=i}}e.Attribute=l;e.VertexFormat=class{_attributes=[];_stride=0;get attributes(){return this._attributes}get stride(){return this._stride}add(e,t,r){return this.attributes.push(new l(e,t,r,this.stride)),this._stride+=r*a(t),this}};e.VertexBuffer=class{uploadFloat32Array(e){this.upload(new Uint8Array(e.buffer),0)}uploadFloats(e){this.uploadFloat32Array(new Float32Array(e))}},function(e){e[e.NEAREST=0]="NEAREST",e[e.LINEAR=1]="LINEAR"}(o=e.PixelFilter||(e.PixelFilter={})),function(e){e[e.REPEAT=0]="REPEAT",e[e.CLAMP=1]="CLAMP"}(s=e.PixelWrap||(e.PixelWrap={}));class c{constructor(e,t,r){this.minFilter=e,this.magFilter=t,this.wrap=r}static LINEAR_CLAMP=new c(o.LINEAR,o.LINEAR,s.CLAMP);static LINEAR_MIN_NEAREST_MAG_CLAMP=new c(o.LINEAR,o.NEAREST,s.CLAMP);static NEAREST_CLAMP=new c(o.NEAREST,o.NEAREST,s.CLAMP)}e.TextureFormat=c}(re||(re={})),function(e){class t extends re.Context{_attributeCount=0;_blendOperations=0;_contextResetHandlers=[];_currentClearColor=re.Color.TRANSPARENT;_currentRenderTarget=null;_defaultViewport=new re.Rect;_forceStateUpdate=!0;_generation=1;_height=0;_oldBlendOperations=0;_oldRenderTarget=null;_oldViewport=new re.Rect;_width=0;get widthInPixels(){return this._width}get heightInPixels(){return this._height}constructor(e=document.createElement("canvas")){super();let t=e.getContext("webgl",{alpha:!1,antialias:!1,depth:!1,preserveDrawingBuffer:!1,stencil:!1});if(null==t)throw new Error("Setup failure");this._gl=t;let r=e.style;e.width=0,e.height=0,r.width=r.height="0",e.addEventListener("webglcontextlost",(e=>{e.preventDefault()})),e.addEventListener("webglcontextrestored",this.handleWebglContextRestored),this._blendOperationMap={[re.BlendOperation.ZERO]:this._gl.ZERO,[re.BlendOperation.ONE]:this._gl.ONE,[re.BlendOperation.SOURCE_COLOR]:this._gl.SRC_COLOR,[re.BlendOperation.TARGET_COLOR]:this._gl.DST_COLOR,[re.BlendOperation.INVERSE_SOURCE_COLOR]:this._gl.ONE_MINUS_SRC_COLOR,[re.BlendOperation.INVERSE_TARGET_COLOR]:this._gl.ONE_MINUS_DST_COLOR,[re.BlendOperation.SOURCE_ALPHA]:this._gl.SRC_ALPHA,[re.BlendOperation.TARGET_ALPHA]:this._gl.DST_ALPHA,[re.BlendOperation.INVERSE_SOURCE_ALPHA]:this._gl.ONE_MINUS_SRC_ALPHA,[re.BlendOperation.INVERSE_TARGET_ALPHA]:this._gl.ONE_MINUS_DST_ALPHA,[re.BlendOperation.CONSTANT]:this._gl.CONSTANT_COLOR,[re.BlendOperation.INVERSE_CONSTANT]:this._gl.ONE_MINUS_CONSTANT_COLOR}}handleWebglContextRestored=()=>{this._attributeCount=0,this._currentClearColor=re.Color.TRANSPARENT,this._forceStateUpdate=!0,this._generation++;for(let e of this._contextResetHandlers)e()};testContextLoss(){this.handleWebglContextRestored()}get gl(){return this._gl}get generation(){return this._generation}addContextResetHandler(e){var t,r;t=this._contextResetHandlers,r=e,-1===t.indexOf(r)&&t.push(r)}removeContextResetHandler(e){!function(e,t){const r=e.indexOf(t);-1!==r&&e.splice(r,1)}(this._contextResetHandlers,e)}get currentRenderTarget(){return this._currentRenderTarget}beginFrame(){this.setRenderTarget(null)}endFrame(){}setBlendState(e,r){this._blendOperations=t._packBlendModes(e,r)}setViewport(e,t,r,i){(null!=this._currentRenderTarget?this._currentRenderTarget.viewport:this._defaultViewport).set(e,t,r,i)}get viewport(){return null!=this._currentRenderTarget?this._currentRenderTarget.viewport:this._defaultViewport}get renderTargetWidthInPixels(){return null!=this._currentRenderTarget?this._currentRenderTarget.viewport.width:this._width}get renderTargetHeightInPixels(){return null!=this._currentRenderTarget?this._currentRenderTarget.viewport.height:this._height}draw(e,t,r){this._updateRenderTargetAndViewport(),h.from(t).prepare(),u.from(r).prepare(),this._updateFormat(t.format),this._updateBlendState(),this._gl.drawArrays(e==re.Primitive.TRIANGLES?this._gl.TRIANGLES:this._gl.TRIANGLE_STRIP,0,Math.floor(r.byteCount/t.format.stride)),this._forceStateUpdate=!1}resize(e,t,r,i){let n=this._gl.canvas;const o=n.getBoundingClientRect();if(this._width===e&&this._height===t&&o.width===r&&o.height===i)return;let s=n.style;n.width=e,n.height=t,s.width=`${r}px`,s.height=`${i}px`,this.setViewport(0,0,e,t),this._width=e,this._height=t,this.resizeEventHandlers.forEach((e=>e()))}clear(e){this._updateRenderTargetAndViewport(),this._updateBlendState(),e.equals(this._currentClearColor)||(this._gl.clearColor(e.redF,e.greenF,e.blueF,e.alphaF),this._currentClearColor=e),this._gl.clear(this._gl.COLOR_BUFFER_BIT)}setRenderTarget(e){this._currentRenderTarget=d.from(e)}createMaterial(e,t,r){let i=new h(this,e,t,r);return i.program,i}createVertexBuffer(e){return te(),new u(this,e)}createTexture(e,t,r,i){return new f(this,e,t,r,i)}createRenderTarget(e){return new d(this,f.from(e))}ANGLE_instanced_arrays=null;ANGLE_instanced_arrays_generation=-1;getANGLE_instanced_arrays(){if(this.ANGLE_instanced_arrays_generation!==this._generation&&(this.ANGLE_instanced_arrays=null),!this.ANGLE_instanced_arrays&&(this.ANGLE_instanced_arrays=this.gl.getExtension("ANGLE_instanced_arrays"),!this.ANGLE_instanced_arrays))throw new Error("Failed to get extension ANGLE_instanced_arrays");return this.ANGLE_instanced_arrays}_updateRenderTargetAndViewport(){let e=this._currentRenderTarget,t=null!=e?e.viewport:this._defaultViewport,r=this._gl;(this._forceStateUpdate||this._oldRenderTarget!=e)&&(r.bindFramebuffer(r.FRAMEBUFFER,e?e.framebuffer:null),this._oldRenderTarget=e),!this._forceStateUpdate&&this._oldViewport.equals(t)||(r.viewport(t.x,this.renderTargetHeightInPixels-t.y-t.height,t.width,t.height),this._oldViewport.set(t.x,t.y,t.width,t.height))}_updateBlendState(){if(this._forceStateUpdate||this._oldBlendOperations!=this._blendOperations){let e=this._gl,r=this._blendOperations,i=this._oldBlendOperations,n=15&r,o=r>>4;te(this._blendOperationMap),te(this._blendOperationMap),r==t.COPY_BLEND_OPERATIONS?e.disable(e.BLEND):((this._forceStateUpdate||i==t.COPY_BLEND_OPERATIONS)&&e.enable(e.BLEND),e.blendFunc(this._blendOperationMap[n],this._blendOperationMap[o])),this._oldBlendOperations=r}}_updateFormat(e){let t=this._gl,r=e.attributes,i=r.length;for(let n=0;n<i;n++){let i=r[n],o=i.type==re.AttributeType.BYTE;t.vertexAttribPointer(n,i.count,o?t.UNSIGNED_BYTE:t.FLOAT,o,e.stride,i.byteOffset)}for(;this._attributeCount<i;)t.enableVertexAttribArray(this._attributeCount),this._attributeCount++;for(;this._attributeCount>i;)this._attributeCount--,t.disableVertexAttribArray(this._attributeCount);this._attributeCount=i}getWebGLInfo(){const e=this.gl.getExtension("WEBGL_debug_renderer_info");return{renderer:e?this.gl.getParameter(e.UNMASKED_RENDERER_WEBGL):null,vendor:e?this.gl.getParameter(e.UNMASKED_VENDOR_WEBGL):null,version:this.gl.getParameter(this.gl.VERSION)}}static from(e){return te(),e}static _packBlendModes(e,t){return e|t<<4}static COPY_BLEND_OPERATIONS=t._packBlendModes(re.BlendOperation.ONE,re.BlendOperation.ZERO)}e.Context=t;class r{constructor(e,t,r=0,i=null,n=!0){this._material=e,this._name=t,this._generation=r,this._location=i,this._isDirty=n}get location(){let e=t.from(this._material.context);if(this._generation!=e.generation&&(this._location=e.gl.getUniformLocation(this._material.program,this._name),this._generation=e.generation),!this._location)throw new Error("Failed to get uniform location");return this._location}}class i extends r{_x=0;set(e){e!=this._x&&(this._x=e,this._isDirty=!0)}prepare(){let e=t.from(this._material.context);(this._generation!=e.generation||this._isDirty)&&(e.gl.uniform1f(this.location,this._x),this._isDirty=!1)}}class n extends r{_x=0;set(e){e!=this._x&&(this._x=e,this._isDirty=!0)}prepare(){let e=t.from(this._material.context);(this._generation!=e.generation||this._isDirty)&&(e.gl.uniform1i(this.location,this._x),this._isDirty=!1)}}class o extends r{_x=0;_y=0;set(e,t){e==this._x&&t==this._y||(this._x=e,this._y=t,this._isDirty=!0)}prepare(){let e=t.from(this._material.context);(this._generation!=e.generation||this._isDirty)&&(e.gl.uniform2f(this.location,this._x,this._y),this._isDirty=!1)}}class s extends r{_x=0;_y=0;_z=0;set(e,t,r){e==this._x&&t==this._y&&r==this._z||(this._x=e,this._y=t,this._z=r,this._isDirty=!0)}prepare(){let e=t.from(this._material.context);(this._generation!=e.generation||this._isDirty)&&(e.gl.uniform3f(this.location,this._x,this._y,this._z),this._isDirty=!1)}}class a extends r{_x=0;_y=0;_z=0;_w=0;set(e,t,r,i){e==this._x&&t==this._y&&r==this._z&&i==this._w||(this._x=e,this._y=t,this._z=r,this._w=i,this._isDirty=!0)}prepare(){let e=t.from(this._material.context);(this._generation!=e.generation||this._isDirty)&&(e.gl.uniform4f(this.location,this._x,this._y,this._z,this._w),this._isDirty=!1)}}class l extends r{_values=[1,0,0,0,1,0,0,0,1];set(e,t,r,i,n,o,s,a,c){l._cachedValues[0]=e,l._cachedValues[1]=i,l._cachedValues[2]=s,l._cachedValues[3]=t,l._cachedValues[4]=n,l._cachedValues[5]=a,l._cachedValues[6]=r,l._cachedValues[7]=o,l._cachedValues[8]=c;for(let e=0;e<9;e++)if(l._cachedValues[e]!=this._values[e]){let e=this._values;this._values=l._cachedValues,l._cachedValues=e,this._isDirty=!0;break}}prepare(){let e=t.from(this._material.context);(this._generation!=e.generation||this._isDirty)&&(e.gl.uniformMatrix3fv(this.location,!1,this._values),this._isDirty=!1)}static _cachedValues=[1,0,0,0,1,0,0,0,1]}class c extends r{_texture=null;_index=-1;set(e,t){this._texture==e&&this._index==t||(this._texture=f.from(e),this._index=t,this._isDirty=!0)}prepare(){let e=t.from(this._material.context),r=e.gl;te(null==this._texture||null==e.currentRenderTarget||(this._texture,e.currentRenderTarget.texture)),(this._generation!=e.generation||this._isDirty)&&(r.uniform1i(this.location,this._index),this._isDirty=!1),r.activeTexture(function(e,t){return te(),e.TEXTURE0+t}(r,this._index)),r.bindTexture(r.TEXTURE_2D,null!=this._texture&&this._texture.width>0&&this._texture.height>0?this._texture.texture:null)}}class h{constructor(e,t,r,i,n={},o=[],s=0,a=null){this._context=e,this._format=t,this._vertexSource=r,this._fragmentSource=i,this._uniformsMap=n,this._uniformsList=o,this._generation=s,this._program=a}get context(){return this._context}get format(){return this._format}get vertexSource(){return this._vertexSource}get fragmentSource(){return this._fragmentSource}setUniformFloat(e,t){let r=this._uniformsMap[e]||null;null==r&&(r=new i(this,e),this._uniformsMap[e]=r,this._uniformsList.push(r)),te(),r.set(t)}setUniformInt(e,t){let r=this._uniformsMap[e]||null;null==r&&(r=new n(this,e),this._uniformsMap[e]=r,this._uniformsList.push(r)),te(),r.set(t)}setUniformVec2(e,t,r){let i=this._uniformsMap[e]||null;null==i&&(i=new o(this,e),this._uniformsMap[e]=i,this._uniformsList.push(i)),te(),i.set(t,r)}setUniformVec3(e,t,r,i){let n=this._uniformsMap[e]||null;null==n&&(n=new s(this,e),this._uniformsMap[e]=n,this._uniformsList.push(n)),te(),n.set(t,r,i)}setUniformVec4(e,t,r,i,n){let o=this._uniformsMap[e]||null;null==o&&(o=new a(this,e),this._uniformsMap[e]=o,this._uniformsList.push(o)),te(),o.set(t,r,i,n)}setUniformMat3(e,t,r,i,n,o,s,a,c,h){let u=this._uniformsMap[e]||null;null==u&&(u=new l(this,e),this._uniformsMap[e]=u,this._uniformsList.push(u)),te(),u.set(t,r,i,n,o,s,a,c,h)}setUniformSampler(e,t,r){let i=this._uniformsMap[e]||null;null==i&&(i=new c(this,e),this._uniformsMap[e]=i,this._uniformsList.push(i)),te(),i.set(t,r)}get program(){let e=this._context.gl;if(this._generation!=this._context.generation){this._program=e.createProgram(),this._compileShader(e,e.VERTEX_SHADER,this.vertexSource),this._compileShader(e,e.FRAGMENT_SHADER,this.fragmentSource);let t=this.format.attributes;for(let r=0;r<t.length;r++)e.bindAttribLocation(this._program,r,t[r].name);if(e.linkProgram(this._program),!e.getProgramParameter(this._program,e.LINK_STATUS))throw new Error(`${e.getProgramInfoLog(this._program)}`);this._generation=this._context.generation}return this._program}prepare(){this._context.gl.useProgram(this.program);for(let e of this._uniformsList)e.prepare()}_compileShader(e,t,r){let i=e.createShader(t);if(!i)throw new Error("Failed to create shader");if(e.shaderSource(i,r),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error(`${e.getShaderInfoLog(i)}`);if(!this._program)throw new Error("Tried to attach shader before program was created");e.attachShader(this._program,i)}static from(e){return te(),e}}class u extends re.VertexBuffer{_generation=0;_buffer=null;_bytes=null;_isDirty=!0;_dirtyMin=u.INT_MAX;_dirtyMax=0;_totalMin=u.INT_MAX;_totalMax=0;_byteCount=0;constructor(e,t){super(),this._context=e,this._byteCount=t,this._bytes=new Uint8Array(t)}get context(){return this._context}get byteCount(){return this._byteCount}move(e,t,r){te(),te(0<=e&&this._byteCount),te(0<=t&&this._byteCount),this._bytes&&e!=t&&0!=r&&(this._bytes.set(this._bytes.subarray(e,this._byteCount),t),this._growDirtyRegion(Math.min(e,t),Math.max(e,t)+r))}upload(e,t=0){te(0<=t&&(e.length,this._byteCount)),te(this._bytes),this._bytes.set(e,t),this._growDirtyRegion(t,t+e.length)}free(){this._buffer&&this._context.gl.deleteBuffer(this._buffer),this._generation=0}prepare(){let e=this._context.gl;this._generation!==this._context.generation&&(this._buffer=e.createBuffer(),this._generation=this._context.generation,this._isDirty=!0),e.bindBuffer(e.ARRAY_BUFFER,this._buffer),this._isDirty&&(e.bufferData(e.ARRAY_BUFFER,this._byteCount,e.DYNAMIC_DRAW),this._dirtyMin=this._totalMin,this._dirtyMax=this._totalMax,this._isDirty=!1),this._dirtyMin<this._dirtyMax&&(e.bufferSubData(e.ARRAY_BUFFER,this._dirtyMin,this._bytes.subarray(this._dirtyMin,this._dirtyMax)),this._dirtyMin=u.INT_MAX,this._dirtyMax=0)}_growDirtyRegion(e,t){this._dirtyMin=Math.min(this._dirtyMin,e),this._dirtyMax=Math.max(this._dirtyMax,t),this._totalMin=Math.min(this._totalMin,e),this._totalMax=Math.max(this._totalMax,t)}static INT_MAX=2147483647;static from(e){return te(),e}}class f{constructor(e,t,r,i,n=null,o=null,s=0,a=!0,l=!0){this._context=e,this._format=t,this._width=r,this._height=i,this._pixels=n,this._texture=o,this._generation=s,this._isFormatDirty=a,this._isContentDirty=l}get context(){return this._context}get format(){return this._format}get width(){return this._width}get height(){return this._height}resize(e,t,r=null){this._width=e,this._height=t,this._pixels=r,this._isContentDirty=!0}setFormat(e){this._format!=e&&(this._format=e,this._isFormatDirty=!0)}get texture(){let e=this._context.gl;return this._generation!=this._context.generation&&(this._texture=e.createTexture(),this._generation=this._context.generation,this._isFormatDirty=!0,this._isContentDirty=!0),this._isFormatDirty&&(e.bindTexture(e.TEXTURE_2D,this._texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.format.magFilter==re.PixelFilter.NEAREST?e.NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.format.minFilter==re.PixelFilter.NEAREST?e.NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.format.wrap==re.PixelWrap.REPEAT?e.REPEAT:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.format.wrap==re.PixelWrap.REPEAT?e.REPEAT:e.CLAMP_TO_EDGE),this._isFormatDirty=!1),this._isContentDirty&&(e.bindTexture(e.TEXTURE_2D,this._texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this._width,this._height,0,e.RGBA,e.UNSIGNED_BYTE,this._pixels),this._isContentDirty=!1),this._texture}free(){this.texture&&(this._context.gl.deleteTexture(this.texture),this._generation=0)}static from(e){return te(),e}}class d{constructor(e,t,r=null,i=0,n=!0,o=new re.Rect){this._context=e,this._texture=t,this._framebuffer=r,this._generation=i,this._isDirty=n,this._viewport=o}get context(){return this._context}get texture(){return this._texture}get viewport(){return this._viewport}setColor(e){this._texture!=e&&(this._texture=f.from(e),this._isDirty=!0)}get framebuffer(){let e=this._context.gl,t=this._texture.texture;return this._generation!=this._context.generation&&(this._framebuffer=e.createFramebuffer(),this._generation=this._context.generation,this._isDirty=!0),this._isDirty&&(e.bindFramebuffer(e.FRAMEBUFFER,this._framebuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),te((e.checkFramebufferStatus(e.FRAMEBUFFER),e.FRAMEBUFFER_COMPLETE)),this._isDirty=!1),this._framebuffer}free(){this._framebuffer&&(this._context.gl.deleteFramebuffer(this._framebuffer),this._generation=0)}static from(e){return te(),e}}}(ie||(ie={}));const ae=new re.VertexFormat;ae.add("configSpacePos",re.AttributeType.FLOAT,2),ae.add("color",re.AttributeType.FLOAT,3);class le{constructor(e){this.gl=e,this.rects=[],this.colors=[],this.buffer=null}getRectCount(){return this.rects.length}getBuffer(){if(this.buffer)return this.buffer;const e=[[0,0],[1,0],[0,1],[1,0],[0,1],[1,1]],t=new Uint8Array(ae.stride*e.length*this.rects.length),r=new Float32Array(t.buffer);let i=0;for(let t=0;t<this.rects.length;t++){const n=this.rects[t],o=this.colors[t];for(let t of e)r[i++]=n.origin.x+t[0]*n.size.x,r[i++]=n.origin.y+t[1]*n.size.y,r[i++]=o.r,r[i++]=o.g,r[i++]=o.b}if(i!==r.length)throw new Error("Buffer expected to be full but wasn't");return this.buffer=this.gl.createVertexBuffer(t.length),this.buffer.upload(t),this.buffer}addRect(e,t){this.rects.push(e),this.colors.push(t),this.buffer&&(this.buffer.free(),this.buffer=null)}free(){this.buffer&&(this.buffer.free(),this.buffer=null)}}class ce{constructor(e){this.gl=e,this.material=e.createMaterial(ae,"\n  uniform mat3 configSpaceToNDC;\n\n  attribute vec2 configSpacePos;\n  attribute vec3 color;\n  varying vec3 vColor;\n\n  void main() {\n    vColor = color;\n    vec2 position = (configSpaceToNDC * vec3(configSpacePos, 1)).xy;\n    gl_Position = vec4(position, 1, 1);\n  }\n","\n  precision mediump float;\n  varying vec3 vColor;\n\n  void main() {\n    gl_FragColor = vec4(vColor.rgb, 1);\n  }\n")}render(e){ne(this.material,"configSpaceToNDC",(()=>{const t=J.betweenRects(e.configSpaceSrcRect,e.physicalSpaceDstRect),r=new Q(this.gl.viewport.width,this.gl.viewport.height);return J.withTranslation(new Q(-1,1)).times(J.withScale(new Q(2,-2).dividedByPointwise(r))).times(t)})()),this.gl.setUnpremultipliedBlendState(),this.gl.draw(re.Primitive.TRIANGLES,this.material,e.batch.getBuffer())}}class he{constructor(e=0,t=0,r=0,i=1){this.r=e,this.g=t,this.b=r,this.a=i}static fromLumaChromaHue(e,t,r){const i=r/60,n=t*(1-Math.abs(i%2-1)),[o,s,a]=i<1?[t,n,0]:i<2?[n,t,0]:i<3?[0,t,n]:i<4?[0,n,t]:i<5?[n,0,t]:[t,0,n],l=e-(.3*o+.59*s+.11*a);return new he(Z(o+l,0,1),Z(s+l,0,1),Z(a+l,0,1),1)}static fromCSSHex(e){if(7!==e.length||"#"!==e[0])throw new Error(`Invalid color input ${e}`);const t=parseInt(e.substr(1,2),16)/255,r=parseInt(e.substr(3,2),16)/255,i=parseInt(e.substr(5,2),16)/255;if(t<0||t>1||r<0||r>1||i<0||i>1)throw new Error(`Invalid color input ${e}`);return new he(t,r,i)}withAlpha(e){return new he(this.r,this.g,this.b,e)}toCSS(){return`rgba(${(255*this.r).toFixed()}, ${(255*this.g).toFixed()}, ${(255*this.b).toFixed()}, ${this.a.toFixed(2)})`}}class ue{constructor(e,t,r){this.gl=e,this.rectangleBatchRenderer=t,this.textureRenderer=r,this.texture=e.createTexture(re.TextureFormat.NEAREST_CLAMP,4096,4096),this.renderTarget=e.createRenderTarget(this.texture),this.rowCache=new q(this.texture.height),this.clearLineBatch=new le(e),this.clearLineBatch.addRect(ee.unit,new he(0,0,0,0)),e.addContextResetHandler((()=>{this.rowCache.clear()}))}has(e){return this.rowCache.has(e)}getResolution(){return this.texture.width}getCapacity(){return this.texture.height}allocateLine(e){if(this.rowCache.getSize()<this.rowCache.getCapacity()){const t=this.rowCache.getSize();return this.rowCache.insert(e,t),t}{const[,t]=this.rowCache.removeLRU();return this.rowCache.insert(e,t),t}}writeToAtlasIfNeeded(e,t){se(this.gl,this.renderTarget,(()=>{for(let r of e){let e=this.rowCache.get(r);if(null!=e)continue;e=this.allocateLine(r);const i=new ee(new Q(0,e),new Q(this.texture.width,1));this.rectangleBatchRenderer.render({batch:this.clearLineBatch,configSpaceSrcRect:ee.unit,physicalSpaceDstRect:i}),t(i,r)}}))}renderViaAtlas(e,t){let r=this.rowCache.get(e);if(null==r)return!1;const i=new ee(new Q(0,r),new Q(this.texture.width,1));return this.textureRenderer.render({texture:this.texture,srcRect:i,dstRect:t}),!0}}class fe{constructor(e){this.gl=e;const t=new re.VertexFormat;t.add("position",re.AttributeType.FLOAT,2),t.add("uv",re.AttributeType.FLOAT,2);const r=[{pos:[-1,1],uv:[0,1]},{pos:[1,1],uv:[1,1]},{pos:[-1,-1],uv:[0,0]},{pos:[1,-1],uv:[1,0]}],i=[];for(let e of r)i.push(e.pos[0]),i.push(e.pos[1]),i.push(e.uv[0]),i.push(e.uv[1]);this.buffer=e.createVertexBuffer(t.stride*r.length),this.buffer.upload(new Uint8Array(new Float32Array(i).buffer)),this.material=e.createMaterial(t,"\n  uniform mat3 uvTransform;\n  uniform mat3 positionTransform;\n\n  attribute vec2 position;\n  attribute vec2 uv;\n  varying vec2 vUv;\n\n  void main() {\n    vUv = (uvTransform * vec3(uv, 1)).xy;\n    gl_Position = vec4((positionTransform * vec3(position, 1)).xy, 0, 1);\n  }\n","\n  precision mediump float;\n\n  varying vec2 vUv;\n  uniform sampler2D texture;\n\n  void main() {\n   gl_FragColor = texture2D(texture, vUv);\n  }\n")}render(e){this.material.setUniformSampler("texture",e.texture,0),ne(this.material,"uvTransform",(()=>{const{srcRect:t,texture:r}=e,i=J.withTranslation(new Q(0,1)).times(J.withScale(new Q(1,-1))).times(J.betweenRects(new ee(Q.zero,new Q(r.width,r.height)),ee.unit)).transformRect(t);return J.betweenRects(ee.unit,i)})()),ne(this.material,"positionTransform",(()=>{const{dstRect:t}=e,{viewport:r}=this.gl,i=new Q(r.width,r.height),n=J.withScale(new Q(1,-1)).times(J.betweenRects(new ee(Q.zero,i),ee.NDC)).transformRect(t);return J.betweenRects(ee.NDC,n)})()),this.gl.setUnpremultipliedBlendState(),this.gl.draw(re.Primitive.TRIANGLE_STRIP,this.material,this.buffer)}}const de=new re.VertexFormat;de.add("position",re.AttributeType.FLOAT,2);class pe{constructor(e,t){this.gl=e;const r=[[-1,1],[1,1],[-1,-1],[1,-1]],i=[];for(let e of r)i.push(e[0]),i.push(e[1]);this.buffer=e.createVertexBuffer(de.stride*r.length),this.buffer.upload(new Uint8Array(new Float32Array(i).buffer)),this.material=e.createMaterial(de,"\n  attribute vec2 position;\n\n  void main() {\n    gl_Position = vec4(position, 0, 1);\n  }\n",(e=>{const{r:t,g:r,b:i}=he.fromCSSHex(e.fgSecondaryColor),n=`${t.toFixed(1)}, ${r.toFixed(1)}, ${i.toFixed(1)}`;return`\n    precision mediump float;\n\n    uniform mat3 configSpaceToPhysicalViewSpace;\n    uniform vec2 physicalSize;\n    uniform vec2 physicalOrigin;\n    uniform vec2 configSpaceViewportOrigin;\n    uniform vec2 configSpaceViewportSize;\n    uniform float framebufferHeight;\n\n    void main() {\n      vec2 origin = (configSpaceToPhysicalViewSpace * vec3(configSpaceViewportOrigin, 1.0)).xy;\n      vec2 size = (configSpaceToPhysicalViewSpace * vec3(configSpaceViewportSize, 0.0)).xy;\n\n      vec2 halfSize = physicalSize / 2.0;\n\n      float borderWidth = 2.0;\n\n      origin = floor(origin * halfSize) / halfSize + borderWidth * vec2(1.0, 1.0);\n      size = floor(size * halfSize) / halfSize - 2.0 * borderWidth * vec2(1.0, 1.0);\n\n      vec2 coord = gl_FragCoord.xy;\n      coord.x = coord.x - physicalOrigin.x;\n      coord.y = framebufferHeight - coord.y - physicalOrigin.y;\n      vec2 clamped = clamp(coord, origin, origin + size);\n      vec2 gap = clamped - coord;\n      float maxdist = max(abs(gap.x), abs(gap.y));\n\n      // TOOD(jlfwong): Could probably optimize this to use mix somehow.\n      if (maxdist == 0.0) {\n        // Inside viewport rectangle\n        gl_FragColor = vec4(0, 0, 0, 0);\n      } else if (maxdist < borderWidth) {\n        // Inside viewport rectangle at border\n        gl_FragColor = vec4(${n}, 0.8);\n      } else {\n        // Outside viewport rectangle\n        gl_FragColor = vec4(${n}, 0.5);\n      }\n    }\n  `})(t))}render(e){ne(this.material,"configSpaceToPhysicalViewSpace",e.configSpaceToPhysicalViewSpace),oe(this.material,"configSpaceViewportOrigin",e.configSpaceViewportRect.origin),oe(this.material,"configSpaceViewportSize",e.configSpaceViewportRect.size);const t=this.gl.viewport;this.material.setUniformVec2("physicalOrigin",t.x,t.y),this.material.setUniformVec2("physicalSize",t.width,t.height),this.material.setUniformFloat("framebufferHeight",this.gl.renderTargetHeightInPixels),this.gl.setBlendState(re.BlendOperation.SOURCE_ALPHA,re.BlendOperation.INVERSE_SOURCE_ALPHA),this.gl.draw(re.Primitive.TRIANGLE_STRIP,this.material,this.buffer)}}const me=new re.VertexFormat;me.add("position",re.AttributeType.FLOAT,2),me.add("uv",re.AttributeType.FLOAT,2);class ge{constructor(e,t){this.gl=e;const r=[{pos:[-1,1],uv:[0,1]},{pos:[1,1],uv:[1,1]},{pos:[-1,-1],uv:[0,0]},{pos:[1,-1],uv:[1,0]}],i=[];for(let e of r)i.push(e.pos[0]),i.push(e.pos[1]),i.push(e.uv[0]),i.push(e.uv[1]);this.buffer=e.createVertexBuffer(me.stride*r.length),this.buffer.uploadFloats(i),this.material=e.createMaterial(me,"\n  uniform mat3 uvTransform;\n  uniform mat3 positionTransform;\n\n  attribute vec2 position;\n  attribute vec2 uv;\n  varying vec2 vUv;\n\n  void main() {\n    vUv = (uvTransform * vec3(uv, 1)).xy;\n    gl_Position = vec4((positionTransform * vec3(position, 1)).xy, 0, 1);\n  }\n",`\n  precision mediump float;\n\n  uniform vec2 uvSpacePixelSize;\n  uniform float renderOutlines;\n\n  varying vec2 vUv;\n  uniform sampler2D colorTexture;\n\n  // https://en.wikipedia.org/wiki/HSL_and_HSV#From_luma/chroma/hue\n  vec3 hcl2rgb(float H, float C, float L) {\n    float hPrime = H / 60.0;\n    float X = C * (1.0 - abs(mod(hPrime, 2.0) - 1.0));\n    vec3 RGB =\n      hPrime < 1.0 ? vec3(C, X, 0) :\n      hPrime < 2.0 ? vec3(X, C, 0) :\n      hPrime < 3.0 ? vec3(0, C, X) :\n      hPrime < 4.0 ? vec3(0, X, C) :\n      hPrime < 5.0 ? vec3(X, 0, C) :\n      vec3(C, 0, X);\n\n    float m = L - dot(RGB, vec3(0.30, 0.59, 0.11));\n    return RGB + vec3(m, m, m);\n  }\n\n  float triangle(float x) {\n    return 2.0 * abs(fract(x) - 0.5) - 1.0;\n  }\n\n  ${t.colorForBucketGLSL}\n\n  void main() {\n    vec4 here = texture2D(colorTexture, vUv);\n\n    if (here.z == 0.0) {\n      // Background color\n      gl_FragColor = vec4(0, 0, 0, 0);\n      return;\n    }\n\n    // Sample the 4 surrounding pixels in the depth texture to determine\n    // if we should draw a boundary here or not.\n    vec4 N = texture2D(colorTexture, vUv + vec2(0, uvSpacePixelSize.y));\n    vec4 E = texture2D(colorTexture, vUv + vec2(uvSpacePixelSize.x, 0));\n    vec4 S = texture2D(colorTexture, vUv + vec2(0, -uvSpacePixelSize.y));\n    vec4 W = texture2D(colorTexture, vUv + vec2(-uvSpacePixelSize.x, 0));\n\n    // NOTE: For outline checks, we intentionally check both the right\n    // and the left to determine if we're an edge. If a rectangle is a single\n    // pixel wide, we don't want to render it as an outline, so this method\n    // of checking ensures that we don't outline single physical-space\n    // pixel width rectangles.\n    if (\n      renderOutlines > 0.0 &&\n      (\n        here.y == N.y && here.y != S.y || // Top edge\n        here.y == S.y && here.y != N.y || // Bottom edge\n        here.x == E.x && here.x != W.x || // Left edge\n        here.x == W.x && here.x != E.x\n      )\n    ) {\n      // We're on an edge! Draw transparent.\n      gl_FragColor = vec4(0, 0, 0, 0);\n    } else {\n      // Not on an edge. Draw the appropriate color.\n      gl_FragColor = vec4(colorForBucket(here.z), here.a);\n    }\n  }\n`)}render(e){const{srcRect:t,rectInfoTexture:r}=e,i=J.withTranslation(new Q(0,1)).times(J.withScale(new Q(1,-1))).times(J.betweenRects(new ee(Q.zero,new Q(r.width,r.height)),ee.unit)).transformRect(t),n=J.betweenRects(ee.unit,i),{dstRect:o}=e,s=new Q(this.gl.viewport.width,this.gl.viewport.height),a=J.withScale(new Q(1,-1)).times(J.betweenRects(new ee(Q.zero,s),ee.NDC)).transformRect(o),l=J.betweenRects(ee.NDC,a),c=Q.unit.dividedByPointwise(new Q(e.rectInfoTexture.width,e.rectInfoTexture.height));this.material.setUniformSampler("colorTexture",e.rectInfoTexture,0),ne(this.material,"uvTransform",n),this.material.setUniformFloat("renderOutlines",e.renderOutlines?1:0),this.material.setUniformVec2("uvSpacePixelSize",c.x,c.y),ne(this.material,"positionTransform",l),this.gl.setUnpremultipliedBlendState(),this.gl.draw(re.Primitive.TRIANGLE_STRIP,this.material,this.buffer)}}class _e{constructor(e,t){this.gl=new ie.Context(e),this.rectangleBatchRenderer=new ce(this.gl),this.textureRenderer=new fe(this.gl),this.viewportRectangleRenderer=new pe(this.gl,t),this.flamechartColorPassRenderer=new ge(this.gl,t),this.theme=t,this.gl.addAfterResizeEventHandler(this.onBeforeFrame);const r=this.gl.getWebGLInfo();r&&console.log(`WebGL initialized. renderer: ${r.renderer}, vendor: ${r.vendor}, version: ${r.version}`),window.testContextLoss=()=>{this.gl.testContextLoss()}}animationFrameRequest=null;beforeFrameHandlers=new Set;addBeforeFrameHandler(e){this.beforeFrameHandlers.add(e)}removeBeforeFrameHandler(e){this.beforeFrameHandlers.delete(e)}requestFrame(){this.animationFrameRequest||(this.animationFrameRequest=requestAnimationFrame(this.onBeforeFrame))}onBeforeFrame=()=>{this.animationFrameRequest=null,this.gl.setViewport(0,0,this.gl.renderTargetWidthInPixels,this.gl.renderTargetHeightInPixels);const e=he.fromCSSHex(this.theme.bgPrimaryColor);this.gl.clear(new re.Color(e.r,e.g,e.b,e.a));for(const e of this.beforeFrameHandlers)e()};setViewport(e,t){const{origin:r,size:i}=e;let n=this.gl.viewport;this.gl.setViewport(r.x,r.y,i.x,i.y),t();let{x:o,y:s,width:a,height:l}=n;this.gl.setViewport(o,s,a,l)}renderBehind(e,t){const r=e.getBoundingClientRect(),i=new ee(new Q(r.left*window.devicePixelRatio,r.top*window.devicePixelRatio),new Q(r.width*window.devicePixelRatio,r.height*window.devicePixelRatio));this.setViewport(i,t)}}let we;var ve;(ve=we||(we={})).Native="Native",ve.Python="Python",ve.Kernel="Kernel";const ye=K((e=>t=>e.get(t.color_key)||0)),Se=$((({theme:e,frameToColorBucket:t})=>{const r=ye(t);return t=>{const i=r(t)/255;return e.colorForBucket(i).toCSS()}})),xe=$((({theme:e,canvas:t})=>new _e(t,e))),Ce=K((e=>new ue(e.gl,e.rectangleBatchRenderer,e.textureRenderer))),Re=$((({profile:e,flattenRecursion:t})=>t?e.getProfileWithRecursionFlattened():e)),Ee=K((e=>{const t=new Map;return t.set(we.Native,100),t.set(we.Python,255),console.log(t),t}));var be,Te,Ae,Le=0,Fe=[],Pe=s.__r,Ne=s.diffed,Oe=s.__c,Ie=s.unmount;function Me(e,t){s.__h&&s.__h(Te,e,Le||t),Le=0;var r=Te.__H||(Te.__H={__:[],__h:[]});return e>=r.__.length&&r.__.push({}),r.__[e]}function Ve(e){return Le=1,ke(Ye,e)}function ke(e,t,r){var i=Me(be++,2);return i.__c||(i.__c=Te,i.__=[r?r(t):Ye(void 0,t),function(t){var r=e(i.__[0],t);i.__[0]!==r&&(i.__[0]=r,i.__c.setState({}))}]),i.__}function We(e,t){var r=Me(be++,3);!s.__s&&Ke(r.__H,t)&&(r.__=e,r.__H=t,Te.__H.__h.push(r))}function Be(e,t){var r=Me(be++,4);!s.__s&&Ke(r.__H,t)&&(r.__=e,r.__H=t,Te.__h.push(r))}function He(e){return Le=5,De((function(){return{current:e}}),[])}function De(e,t){var r=Me(be++,7);return Ke(r.__H,t)?(r.__H=t,r.__h=e,r.__=e()):r.__}function ze(e,t){return Le=8,De((function(){return e}),t)}function Ge(e){var t=Te.context[e.__c],r=Me(be++,9);return r.__c=e,t?(null==r.__&&(r.__=!0,t.sub(Te)),t.props.value):e.__}function Ue(){Fe.some((function(e){if(e.__P)try{e.__H.__h.forEach(je),e.__H.__h.forEach($e),e.__H.__h=[]}catch(t){return e.__H.__h=[],s.__e(t,e.__v),!0}})),Fe=[]}function je(e){e.t&&e.t()}function $e(e){var t=e.__();"function"==typeof t&&(e.t=t)}function Ke(e,t){return!e||t.some((function(t,r){return t!==e[r]}))}function Ye(e,t){return"function"==typeof t?t(e):t}function Xe(e,t){for(var r in t)e[r]=t[r];return e}function qe(e,t){for(var r in e)if("__source"!==r&&!(r in t))return!0;for(var i in t)if("__source"!==i&&e[i]!==t[i])return!0;return!1}s.__r=function(e){Pe&&Pe(e),be=0,(Te=e.__c).__H&&(Te.__H.__h.forEach(je),Te.__H.__h.forEach($e),Te.__H.__h=[])},s.diffed=function(e){Ne&&Ne(e);var t=e.__c;if(t){var r=t.__H;r&&r.__h.length&&(1!==Fe.push(t)&&Ae===s.requestAnimationFrame||((Ae=s.requestAnimationFrame)||function(e){var t,r=function(){clearTimeout(i),cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(r,100);"undefined"!=typeof window&&(t=requestAnimationFrame(r))})(Ue))}},s.__c=function(e,t){t.some((function(e){try{e.__h.forEach(je),e.__h=e.__h.filter((function(e){return!e.__||$e(e)}))}catch(r){t.some((function(e){e.__h&&(e.__h=[])})),t=[],s.__e(r,e.__v)}})),Oe&&Oe(e,t)},s.unmount=function(e){Ie&&Ie(e);var t=e.__c;if(t){var r=t.__H;if(r)try{r.__.forEach((function(e){return e.t&&e.t()}))}catch(e){s.__e(e,t.__v)}}};!function(e){var t,r;function i(t){var r;return(r=e.call(this,t)||this).isPureReactComponent=!0,r}r=e,(t=i).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,i.prototype.shouldComponentUpdate=function(e,t){return qe(this.props,e)||qe(this.state,t)}}(S);function Ze(e,t){function r(e){var r=this.props.ref,i=r==e.ref;return!i&&r&&(r.call?r(null):r.current=null),t?!t(this.props,e)||!i:qe(this.props,e)}function i(t){return this.shouldComponentUpdate=r,w(e,Xe({},t))}return i.prototype.isReactComponent=!0,i.displayName="Memo("+(e.displayName||e.name)+")",i.t=!0,i}var Qe=s.__b;s.__b=function(e){e.type&&e.type.t&&e.ref&&(e.props.ref=e.ref,e.ref=null),Qe&&Qe(e)};var Je=s.__e;function et(e){return e&&((e=Xe({},e)).__c=null,e.__k=e.__k&&e.__k.map(et)),e}function tt(){this.__u=0,this.o=null,this.__b=null}function rt(e){var t=e.__.__c;return t&&t.u&&t.u(e)}function it(){this.i=null,this.l=null}s.__e=function(e,t,r){if(e.then)for(var i,n=t;n=n.__;)if((i=n.__c)&&i.__c)return i.__c(e,t.__c);Je(e,t,r)},(tt.prototype=new S).__c=function(e,t){var r=this;null==r.o&&(r.o=[]),r.o.push(t);var i=rt(r.__v),n=!1,o=function(){n||(n=!0,i?i(s):s())};t.__c=t.componentWillUnmount,t.componentWillUnmount=function(){o(),t.__c&&t.__c()};var s=function(){var e;if(!--r.__u)for(r.__v.__k[0]=r.state.u,r.setState({u:r.__b=null});e=r.o.pop();)e.forceUpdate()};r.__u++||r.setState({u:r.__b=r.__v.__k[0]}),e.then(o,o)},tt.prototype.render=function(e,t){return this.__b&&(this.__v.__k[0]=et(this.__b),this.__b=null),[w(S,null,t.u?null:e.children),t.u&&e.fallback]};var nt=function(e,t,r){if(++r[1]===r[0]&&e.l.delete(t),e.props.revealOrder&&("t"!==e.props.revealOrder[0]||!e.l.size))for(r=e.i;r;){for(;r.length>3;)r.pop()();if(r[1]<r[0])break;e.i=r=r[2]}};(it.prototype=new S).u=function(e){var t=this,r=rt(t.__v),i=t.l.get(e);return i[0]++,function(n){var o=function(){t.props.revealOrder?(i.push(n),nt(t,e,i)):n()};r?r(o):o()}},it.prototype.render=function(e){this.i=null,this.l=new Map;var t=T(e.children);e.revealOrder&&"b"===e.revealOrder[0]&&t.reverse();for(var r=t.length;r--;)this.l.set(t[r],this.i=[1,0,this.i]);return e.children},it.prototype.componentDidUpdate=it.prototype.componentDidMount=function(){var e=this;e.l.forEach((function(t,r){nt(e,r,t)}))};!function(){function e(){}var t=e.prototype;t.getChildContext=function(){return this.props.context},t.render=function(e){return e.children}}();var ot=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/;S.prototype.isReactComponent={};var st="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;var at=s.event;function lt(e,t){e["UNSAFE_"+t]&&!e[t]&&Object.defineProperty(e,t,{configurable:!1,get:function(){return this["UNSAFE_"+t]},set:function(e){this["UNSAFE_"+t]=e}})}s.event=function(e){at&&(e=at(e)),e.persist=function(){};var t=!1,r=!1,i=e.stopPropagation;e.stopPropagation=function(){i.call(e),t=!0};var n=e.preventDefault;return e.preventDefault=function(){n.call(e),r=!0},e.isPropagationStopped=function(){return t},e.isDefaultPrevented=function(){return r},e.nativeEvent=e};var ct={configurable:!0,get:function(){return this.class}},ht=s.vnode;s.vnode=function(e){e.$$typeof=st;var t=e.type,r=e.props;if(t){if(r.class!=r.className&&(ct.enumerable="className"in r,null!=r.className&&(r.class=r.className),Object.defineProperty(r,"className",ct)),"function"!=typeof t){var i,n,o;for(o in r.defaultValue&&void 0!==r.value&&(r.value||0===r.value||(r.value=r.defaultValue),delete r.defaultValue),Array.isArray(r.value)&&r.multiple&&"select"===t&&(T(r.children).forEach((function(e){-1!=r.value.indexOf(e.props.value)&&(e.props.selected=!0)})),delete r.value),r)if(i=ot.test(o))break;if(i)for(o in n=e.props={},r)n[ot.test(o)?o.replace(/[A-Z0-9]/,"-$&").toLowerCase():o]=r[o]}!function(t){var r=e.type,i=e.props;if(i&&"string"==typeof r){var n={};for(var o in i)/^on(Ani|Tra|Tou)/.test(o)&&(i[o.toLowerCase()]=i[o],delete i[o]),n[o.toLowerCase()]=o;if(n.ondoubleclick&&(i.ondblclick=i[n.ondoubleclick],delete i[n.ondoubleclick]),n.onbeforeinput&&(i.onbeforeinput=i[n.onbeforeinput],delete i[n.onbeforeinput]),n.onchange&&("textarea"===r||"input"===r.toLowerCase()&&!/^fil|che|ra/i.test(i.type))){var s=n.oninput||"oninput";i[s]||(i[s]=i[n.onchange],delete i[n.onchange])}}}(),"function"==typeof t&&!t.m&&t.prototype&&(lt(t.prototype,"componentWillMount"),lt(t.prototype,"componentWillReceiveProps"),lt(t.prototype,"componentWillUpdate"),t.m=!0)}ht&&ht(e)};let ut;class ft{constructor(e,t){this.state=e,this.observers=[],this.set=this.set.bind(this),this.get=this.get.bind(this)}set(e){this.state!==e&&(this.state=e,this.observers.forEach((e=>e())))}get(){return this.state}subscribe(e){this.observers.push(e)}unsubscribe(e){const t=this.observers.indexOf(e);-1!==t&&this.observers.splice(t,1)}}function dt(e){const[t,r]=Ve(e.get());return Be((()=>{function t(){r(e.get())}return r(e.get()),e.subscribe(t),()=>{e.unsubscribe(t)}}),[e]),t}var pt;function mt(e){switch(e){case"time-ordered":return ut.CHRONO_FLAME_CHART;case"left-heavy":return ut.LEFT_HEAVY_FLAME_GRAPH;case"sandwich":return ut.SANDWICH_VIEW;default:return null}}let gt;var _t;(pt=ut||(ut={}))[pt.CHRONO_FLAME_CHART=0]="CHRONO_FLAME_CHART",pt[pt.LEFT_HEAVY_FLAME_GRAPH=1]="LEFT_HEAVY_FLAME_GRAPH",pt[pt.SANDWICH_VIEW=2]="SANDWICH_VIEW",(_t=gt||(gt={})).LEFT_HEAVY="LEFT_HEAVY",_t.CHRONO="CHRONO",_t.SANDWICH_INVERTED_CALLERS="SANDWICH_INVERTED_CALLERS",_t.SANDWICH_CALLEES="SANDWICH_CALLEES";let wt={hover:null,selectedNode:null,configSpaceViewportRect:ee.empty,logicalSpaceViewportSize:Q.zero};const vt=new ft(!1,"flattenRecursion"),yt=new ft(!1,"searchIsActive"),St=new ft("","searchQueryAtom"),xt=new ft(ut.CHRONO_FLAME_CHART,"viewMode"),Ct=new class extends ft{set(e){const t=this.state;null!=t&&null!=e&&j(t,e)||super.set(e)}getActiveProfile(){return null==this.state?null:this.state.profile}setProfileGroup=e=>{const t=e.profile;console.log(this.state?.profile.chronoViewState),this.set({name:e.name,profile:{profile:t,chronoViewState:this.state?.profile.chronoViewState||wt,leftHeavyViewState:this.state?.profile.leftHeavyViewState||wt,sandwichViewState:{callerCallee:null}}})};updateActiveProfileState(e){null!=this.state&&this.set({...this.state,profile:e(this.state.profile)})}updateActiveSandwichViewState(e){this.updateActiveProfileState((t=>({...t,sandwichViewState:e(t.sandwichViewState)})))}setSelectedFrame=e=>{if(null==this.state)return;null!=this.getActiveProfile()&&this.updateActiveSandwichViewState((t=>null==e?{callerCallee:null}:{callerCallee:{invertedCallerFlamegraph:wt,calleeFlamegraph:wt,selectedFrame:e}}))};updateFlamechartState(e,t){switch(e){case gt.CHRONO:this.updateActiveProfileState((e=>({...e,chronoViewState:t(e.chronoViewState)})));break;case gt.LEFT_HEAVY:this.updateActiveProfileState((e=>({...e,leftHeavyViewState:t(e.leftHeavyViewState)})));break;case gt.SANDWICH_CALLEES:this.updateActiveSandwichViewState((e=>({...e,callerCallee:null==e.callerCallee?null:{...e.callerCallee,calleeFlamegraph:t(e.callerCallee.calleeFlamegraph)}})));break;case gt.SANDWICH_INVERTED_CALLERS:this.updateActiveSandwichViewState((e=>({...e,callerCallee:null==e.callerCallee?null:{...e.callerCallee,invertedCallerFlamegraph:t(e.callerCallee.invertedCallerFlamegraph)}})))}}setFlamechartHoveredNode(e,t){this.updateFlamechartState(e,(e=>({...e,hover:t})))}setSelectedNode(e,t){this.updateFlamechartState(e,(e=>({...e,selectedNode:t})))}setConfigSpaceViewportRect(e,t){this.updateFlamechartState(e,(e=>({...e,configSpaceViewportRect:t})))}setLogicalSpaceViewportSize(e,t){this.updateFlamechartState(e,(e=>({...e,logicalSpaceViewportSize:t})))}clearHoverNode(){this.setFlamechartHoveredNode(gt.CHRONO,null),this.setFlamechartHoveredNode(gt.LEFT_HEAVY,null),this.setFlamechartHoveredNode(gt.SANDWICH_CALLEES,null),this.setFlamechartHoveredNode(gt.SANDWICH_INVERTED_CALLERS,null)}}(null,"profileGroup");xt.subscribe((()=>{Ct.clearHoverNode()}));const Rt=function(e=window.location.hash){try{if(!e.startsWith("#"))return{};const t=e.substr(1).split("&"),r={};for(const e of t){let[t,i]=e.split("=");if(i=decodeURIComponent(i),"profileURL"===t)r.profileURL=i;else if("title"===t)r.title=i;else if("localProfilePath"===t)r.localProfilePath=i;else if("view"===t){const e=mt(i);null!==e?r.viewMode=e:console.error(`Ignoring invalid view specifier: ${i}`)}}return r}catch(e){return console.error("Error when loading hash fragment."),console.error(e),{}}}(),Et=new ft(Rt,"hashParams"),bt=new ft(null,"glCanvas"),Tt=new ft(!1,"dragActive"),At=window.location.protocol,Lt=("http:"===At||"https:"===At)&&null!=Rt.profileURL,Ft=new ft(Lt,"loading"),Pt=new ft(!1,"error");let Nt;var Ot;let It;var Mt;(Ot=Nt||(Nt={}))[Ot.SYMBOL_NAME=0]="SYMBOL_NAME",Ot[Ot.SELF=1]="SELF",Ot[Ot.TOTAL=2]="TOTAL",(Mt=It||(It={}))[Mt.ASCENDING=0]="ASCENDING",Mt[Mt.DESCENDING=1]="DESCENDING";const Vt=new ft({field:Nt.SELF,direction:It.DESCENDING},"tableSortMethod");function kt(){const e=dt(vt),t=dt(Ct);if(!t)return null;const r=t.profile;return{...t.profile,profile:Re({profile:r.profile,flattenRecursion:e})}}let Wt;var Bt;(Bt=Wt||(Wt={}))[Bt.SYSTEM=0]="SYSTEM",Bt[Bt.DARK=1]="DARK",Bt[Bt.LIGHT=2]="LIGHT";const Ht="speedscope-color-scheme";function Dt(e){if(matchMedia("(prefers-color-scheme: dark)").matches)switch(e){case 0:return 2;case 2:return 1;case 1:return 0}else switch(e){case 0:return 1;case 1:return 2;case 2:return 0}}const zt=new class extends ft{cycleToNextColorScheme=()=>{this.set(Dt(this.get()))}}(function(){const e=window.localStorage&&window.localStorage[Ht];return"DARK"===e?1:"LIGHT"===e?2:0}(),"colorScheme");let Gt;var Ut;zt.subscribe((()=>{const e=zt.get();switch(e){case 1:window.localStorage[Ht]="DARK";break;case 2:window.localStorage[Ht]="LIGHT";break;case 0:delete window.localStorage[Ht];break;default:return e}return e})),(Ut=Gt||(Gt={})).LIGHTER_GRAY="#D0D0D0",Ut.LIGHT_GRAY="#BDBDBD",Ut.GRAY="#666666",Ut.DARK_GRAY="#222222",Ut.DARKER_GRAY="#0C0C0C",Ut.OFF_BLACK="#060606",Ut.BLACK="#000000",Ut.BLUE="#00769B",Ut.PALE_BLUE="#004E75",Ut.GREEN="#0F8A42",Ut.LIGHT_BROWN="#D6AE24",Ut.BROWN="#A66F1C";const jt=`\n  vec3 colorForBucket(float t) {\n    float x = triangle(30.0 * t);\n    float H = 360.0 * (0.9 * t);\n    float C = ${.2.toFixed(1)} + ${.1.toFixed(1)} * x;\n    float L = ${.2.toFixed(1)} - ${.1.toFixed(1)} * x;\n    return hcl2rgb(H, C, L);\n  }\n`,$t={fgPrimaryColor:Gt.LIGHTER_GRAY,fgSecondaryColor:Gt.GRAY,bgPrimaryColor:Gt.OFF_BLACK,bgSecondaryColor:Gt.DARKER_GRAY,altFgPrimaryColor:Gt.LIGHTER_GRAY,altFgSecondaryColor:Gt.GRAY,altBgPrimaryColor:Gt.BLACK,altBgSecondaryColor:Gt.DARKER_GRAY,selectionPrimaryColor:Gt.BLUE,selectionSecondaryColor:Gt.PALE_BLUE,weightColor:Gt.GREEN,searchMatchTextColor:Gt.DARKER_GRAY,searchMatchPrimaryColor:Gt.BROWN,searchMatchSecondaryColor:Gt.LIGHT_BROWN,colorForBucket:e=>{const t=z(30*e);return he.fromLumaChromaHue(.2-.1*t,.2+.1*t,.9*e*360)},colorForBucketGLSL:jt};let Kt;!function(e){e.WHITE="#FFFFFF",e.OFF_WHITE="#F6F6F6",e.LIGHT_GRAY="#BDBDBD",e.GRAY="#666666",e.DARK_GRAY="#222222",e.OFF_BLACK="#111111",e.BLACK="#000000",e.DARK_BLUE="#2F80ED",e.PALE_DARK_BLUE="#8EB7ED",e.GREEN="#6FCF97",e.YELLOW="#FEDC62",e.ORANGE="#FFAC02"}(Kt||(Kt={}));const Yt=`\n  vec3 colorForBucket(float t) {\n    float x = triangle(30.0 * t);\n    float H = 360.0 * (0.9 * t);\n    float C = ${.25.toFixed(1)} + ${.2.toFixed(1)} * x;\n    float L = ${.8.toFixed(1)} - ${.15.toFixed(1)} * x;\n    return hcl2rgb(H, C, L);\n  }\n`,Xt={fgPrimaryColor:Kt.BLACK,fgSecondaryColor:Kt.LIGHT_GRAY,bgPrimaryColor:Kt.WHITE,bgSecondaryColor:Kt.OFF_WHITE,altFgPrimaryColor:Kt.WHITE,altFgSecondaryColor:Kt.LIGHT_GRAY,altBgPrimaryColor:Kt.BLACK,altBgSecondaryColor:Kt.DARK_GRAY,selectionPrimaryColor:Kt.DARK_BLUE,selectionSecondaryColor:Kt.PALE_DARK_BLUE,weightColor:Kt.GREEN,searchMatchTextColor:Kt.BLACK,searchMatchPrimaryColor:Kt.ORANGE,searchMatchSecondaryColor:Kt.YELLOW,colorForBucket:e=>{const t=z(30*e);return he.fromLumaChromaHue(.8-.15*t,.25+.2*t,.9*e*360)},colorForBucketGLSL:Yt},qt=k(Xt);function Zt(){return Ge(qt)}function Qt(e){return K(e)}function Jt(){return matchMedia("(prefers-color-scheme: dark)")}var er={};Object.defineProperty(er,"__esModule",{value:!0}),er.default=function(e,t){if("string"==typeof t&&!(0,nr.default)(t)&&t.indexOf("calc(")>-1)return or.map((function(e){return t.replace(/calc\(/g,e+"calc(")}))};var tr={};Object.defineProperty(tr,"__esModule",{value:!0}),tr.default=function(e){return"string"==typeof e&&rr.test(e)};var rr=/-webkit-|-moz-|-ms-/;tr=tr.default;var ir,nr=(ir=tr)&&ir.__esModule?ir:{default:ir};var or=["-webkit-","-moz-",""];er=er.default;var sr={};Object.defineProperty(sr,"__esModule",{value:!0}),sr.default=function(e,t){if("string"==typeof t&&!(0,ar.default)(t)&&t.indexOf("cross-fade(")>-1)return lr.map((function(e){return t.replace(/cross-fade\(/g,e+"cross-fade(")}))};var ar=function(e){return e&&e.__esModule?e:{default:e}}(tr);var lr=["-webkit-",""];sr=sr.default;var cr={};Object.defineProperty(cr,"__esModule",{value:!0}),cr.default=function(e,t){if("cursor"===e&&ur.hasOwnProperty(t))return hr.map((function(e){return e+t}))};var hr=["-webkit-","-moz-",""],ur={"zoom-in":!0,"zoom-out":!0,grab:!0,grabbing:!0};cr=cr.default;var fr={};Object.defineProperty(fr,"__esModule",{value:!0}),fr.default=function(e,t){if("string"==typeof t&&!(0,dr.default)(t)&&t.indexOf("filter(")>-1)return pr.map((function(e){return t.replace(/filter\(/g,e+"filter(")}))};var dr=function(e){return e&&e.__esModule?e:{default:e}}(tr);var pr=["-webkit-",""];fr=fr.default;var mr={};Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=function(e,t){if("display"===e&&gr.hasOwnProperty(t))return gr[t]};var gr={flex:["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex","flex"],"inline-flex":["-webkit-inline-box","-moz-inline-box","-ms-inline-flexbox","-webkit-inline-flex","inline-flex"]};mr=mr.default;var _r={};Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=function(e,t,r){vr.hasOwnProperty(e)&&(r[vr[e]]=wr[t]||t)};var wr={"space-around":"distribute","space-between":"justify","flex-start":"start","flex-end":"end"},vr={alignContent:"msFlexLinePack",alignSelf:"msFlexItemAlign",alignItems:"msFlexAlign",justifyContent:"msFlexPack",order:"msFlexOrder",flexGrow:"msFlexPositive",flexShrink:"msFlexNegative",flexBasis:"msFlexPreferredSize"};_r=_r.default;var yr={};Object.defineProperty(yr,"__esModule",{value:!0}),yr.default=function(e,t,r){"flexDirection"===e&&"string"==typeof t&&(t.indexOf("column")>-1?r.WebkitBoxOrient="vertical":r.WebkitBoxOrient="horizontal",t.indexOf("reverse")>-1?r.WebkitBoxDirection="reverse":r.WebkitBoxDirection="normal");xr.hasOwnProperty(e)&&(r[xr[e]]=Sr[t]||t)};var Sr={"space-around":"justify","space-between":"justify","flex-start":"start","flex-end":"end","wrap-reverse":"multiple",wrap:"multiple"},xr={alignItems:"WebkitBoxAlign",justifyContent:"WebkitBoxPack",flexWrap:"WebkitBoxLines"};yr=yr.default;var Cr={};Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.default=function(e,t){if("string"==typeof t&&!(0,Rr.default)(t)&&br.test(t))return Er.map((function(e){return e+t}))};var Rr=function(e){return e&&e.__esModule?e:{default:e}}(tr);var Er=["-webkit-","-moz-",""],br=/linear-gradient|radial-gradient|repeating-linear-gradient|repeating-radial-gradient/;Cr=Cr.default;var Tr={};Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.default=function(e,t){if("string"==typeof t&&!(0,Ar.default)(t)&&t.indexOf("image-set(")>-1)return Lr.map((function(e){return t.replace(/image-set\(/g,e+"image-set(")}))};var Ar=function(e){return e&&e.__esModule?e:{default:e}}(tr);var Lr=["-webkit-",""];Tr=Tr.default;var Fr={};Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.default=function(e,t){if("position"===e&&"sticky"===t)return["-webkit-sticky","sticky"]},Fr=Fr.default;var Pr={};Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.default=function(e,t){if(Or.hasOwnProperty(e)&&Ir.hasOwnProperty(t))return Nr.map((function(e){return e+t}))};var Nr=["-webkit-","-moz-",""],Or={maxHeight:!0,maxWidth:!0,width:!0,height:!0,columnWidth:!0,minWidth:!0,minHeight:!0},Ir={"min-content":!0,"max-content":!0,"fill-available":!0,"fit-content":!0,"contain-floats":!0};Pr=Pr.default;var Mr={};Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.default=function(e,t,r,i){if("string"==typeof t&&$r.hasOwnProperty(e)){var n=function(e,t){if((0,zr.default)(e))return e;for(var r=e.split(/,(?![^()]*(?:\([^()]*\))?\))/g),i=0,n=r.length;i<n;++i){var o=r[i],s=[o];for(var a in t){var l=(0,Dr.default)(a);if(o.indexOf(l)>-1&&"order"!==l)for(var c=t[a],h=0,u=c.length;h<u;++h)s.unshift(o.replace(l,Kr[c[h]]+l))}r[i]=s.join(",")}return r.join(",")}(t,i),o=n.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-moz-|-ms-/.test(e)})).join(",");if(e.indexOf("Webkit")>-1)return o;var s=n.split(/,(?![^()]*(?:\([^()]*\))?\))/g).filter((function(e){return!/-webkit-|-ms-/.test(e)})).join(",");return e.indexOf("Moz")>-1?s:(r["Webkit"+(0,Ur.default)(e)]=o,r["Moz"+(0,Ur.default)(e)]=s,n)}};var Vr={};Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.default=function(e){return(0,Hr.default)(e)};var kr=/[A-Z]/g,Wr=/^ms-/,Br={};var Hr=function(e){return e&&e.__esModule?e:{default:e}}((function(e){return e in Br?Br[e]:Br[e]=e.replace(kr,"-$&").toLowerCase().replace(Wr,"-ms-")}));var Dr=jr(Vr=Vr.default),zr=jr(tr),Gr={};Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.default=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};var Ur=jr(Gr=Gr.default);function jr(e){return e&&e.__esModule?e:{default:e}}var $r={transition:!0,transitionProperty:!0,WebkitTransition:!0,WebkitTransitionProperty:!0,MozTransition:!0,MozTransitionProperty:!0},Kr={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-"};Mr=Mr.default;var Yr;Yr=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return t>>>0};var Xr={};Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.default=function(e){var t=e.prefixMap,r=e.plugins;return function e(i){for(var n in i){var o=i[n];if((0,oi.default)(o))i[n]=e(o);else if(Array.isArray(o)){for(var s=[],a=0,l=o.length;a<l;++a){var c=(0,ei.default)(r,n,o[a],i,t);(0,ii.default)(s,c||o[a])}s.length>0&&(i[n]=s)}else{var h=(0,ei.default)(r,n,o,i,t);h&&(i[n]=h),i=(0,Qr.default)(t,n,i)}}return i}};var qr={};Object.defineProperty(qr,"__esModule",{value:!0}),qr.default=function(e,t,r){if(e.hasOwnProperty(t)){for(var i={},n=e[t],o=(0,Zr.default)(t),s=Object.keys(r),a=0;a<s.length;a++){var l=s[a];if(l===t)for(var c=0;c<n.length;c++)i[n[c]+o]=r[t];i[l]=r[l]}return i}return r};var Zr=function(e){return e&&e.__esModule?e:{default:e}}(Gr);var Qr=si(qr=qr.default),Jr={};Object.defineProperty(Jr,"__esModule",{value:!0}),Jr.default=function(e,t,r,i,n){for(var o=0,s=e.length;o<s;++o){var a=e[o](t,r,i,n);if(a)return a}};var ei=si(Jr=Jr.default),ti={};function ri(e,t){-1===e.indexOf(t)&&e.push(t)}Object.defineProperty(ti,"__esModule",{value:!0}),ti.default=function(e,t){if(Array.isArray(t))for(var r=0,i=t.length;r<i;++r)ri(e,t[r]);else ri(e,t)};var ii=si(ti=ti.default),ni={};Object.defineProperty(ni,"__esModule",{value:!0}),ni.default=function(e){return e instanceof Object&&!Array.isArray(e)};var oi=si(ni=ni.default);function si(e){return e&&e.__esModule?e:{default:e}}Xr=Xr.default;var ai,li={};function ci(e){ui.length||(hi(),!0),ui[ui.length]=e}li=ci;var hi,ui=[],fi=0;function di(){for(;fi<ui.length;){var e=fi;if(fi+=1,ui[e].call(),fi>1024){for(var t=0,r=ui.length-fi;t<r;t++)ui[t]=ui[t+fi];ui.length-=fi,fi=0}}ui.length=0,fi=0,!1}var pi,mi,gi,_i=void 0!==r?r:self,wi=_i.MutationObserver||_i.WebKitMutationObserver;function vi(e){return function(){var t=setTimeout(i,0),r=setInterval(i,50);function i(){clearTimeout(t),clearInterval(r),e()}}}"function"==typeof wi?(pi=1,mi=new wi(di),gi=document.createTextNode(""),mi.observe(gi,{characterData:!0}),hi=function(){pi=-pi,gi.data=pi}):hi=vi(di),ci.requestFlush=hi,ci.makeRequestCallFromTimer=vi;var yi=[],Si=[],xi=li.makeRequestCallFromTimer((function(){if(Si.length)throw Si.shift()}));function Ci(e){var t;(t=yi.length?yi.pop():new Ri).task=e,li(t)}function Ri(){this.task=null}ai=Ci,Ri.prototype.call=function(){try{this.task.call()}catch(e){Ci.onerror?Ci.onerror(e):(Si.push(e),xi())}finally{this.task=null,yi[yi.length]=this}};var Ei=["Webkit"],bi=["Moz"],Ti=["ms"],Ai=["Webkit","Moz"],Li=["Webkit","ms"],Fi=["Webkit","Moz","ms"],Pi={plugins:[t(er),t(sr),t(cr),t(fr),t(mr),t(_r),t(yr),t(Cr),t(Tr),t(Fr),t(Pr),t(Mr)],prefixMap:{transform:Li,transformOrigin:Li,transformOriginX:Li,transformOriginY:Li,backfaceVisibility:Ei,perspective:Ei,perspectiveOrigin:Ei,transformStyle:Ei,transformOriginZ:Ei,animation:Ei,animationDelay:Ei,animationDirection:Ei,animationFillMode:Ei,animationDuration:Ei,animationIterationCount:Ei,animationName:Ei,animationPlayState:Ei,animationTimingFunction:Ei,appearance:Ai,userSelect:Fi,fontKerning:Ei,textEmphasisPosition:Ei,textEmphasis:Ei,textEmphasisStyle:Ei,textEmphasisColor:Ei,boxDecorationBreak:Ei,clipPath:Ei,maskImage:Ei,maskMode:Ei,maskRepeat:Ei,maskPosition:Ei,maskClip:Ei,maskOrigin:Ei,maskSize:Ei,maskComposite:Ei,mask:Ei,maskBorderSource:Ei,maskBorderMode:Ei,maskBorderSlice:Ei,maskBorderWidth:Ei,maskBorderOutset:Ei,maskBorderRepeat:Ei,maskBorder:Ei,maskType:Ei,textDecorationStyle:Ai,textDecorationSkip:Ai,textDecorationLine:Ai,textDecorationColor:Ai,filter:Ei,fontFeatureSettings:Ai,breakAfter:Fi,breakBefore:Fi,breakInside:Fi,columnCount:Ai,columnFill:Ai,columnGap:Ai,columnRule:Ai,columnRuleColor:Ai,columnRuleStyle:Ai,columnRuleWidth:Ai,columns:Ai,columnSpan:Ai,columnWidth:Ai,writingMode:Li,flex:Li,flexBasis:Ei,flexDirection:Li,flexGrow:Ei,flexFlow:Li,flexShrink:Ei,flexWrap:Li,alignContent:Ei,alignItems:Ei,alignSelf:Ei,justifyContent:Ei,order:Ei,transitionDelay:Ei,transitionDuration:Ei,transitionProperty:Ei,transitionTimingFunction:Ei,backdropFilter:Ei,scrollSnapType:Li,scrollSnapPointsX:Li,scrollSnapPointsY:Li,scrollSnapDestination:Li,scrollSnapCoordinate:Li,shapeImageThreshold:Ei,shapeImageMargin:Ei,shapeImageOutside:Ei,hyphens:Fi,flowInto:Li,flowFrom:Li,regionFragment:Li,boxSizing:bi,textAlignLast:bi,tabSize:bi,wrapFlow:Ti,wrapThrough:Ti,wrapMargin:Ti,touchAction:Ti,gridTemplateColumns:Ti,gridTemplateRows:Ti,gridTemplateAreas:Ti,gridTemplate:Ti,gridAutoColumns:Ti,gridAutoRows:Ti,gridAutoFlow:Ti,grid:Ti,gridRowStart:Ti,gridColumnStart:Ti,gridRowEnd:Ti,gridRow:Ti,gridColumn:Ti,gridColumnEnd:Ti,gridColumnGap:Ti,gridRowGap:Ti,gridArea:Ti,gridGap:Ti,textSizeAdjust:Li,borderImage:Ei,borderImageOutset:Ei,borderImageRepeat:Ei,borderImageSlice:Ei,borderImageSource:Ei,borderImageWidth:Ei}},Ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oi=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();var Ii="undefined"!=typeof Map,Mi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.elements={},this.keyOrder=[]}return Oi(e,[{key:"forEach",value:function(e){for(var t=0;t<this.keyOrder.length;t++)e(this.elements[this.keyOrder[t]],this.keyOrder[t])}},{key:"set",value:function(t,r,i){if(this.elements.hasOwnProperty(t)){if(i){var n=this.keyOrder.indexOf(t);this.keyOrder.splice(n,1),this.keyOrder.push(t)}}else this.keyOrder.push(t);if(null!=r){if(Ii&&r instanceof Map||r instanceof e){var o=this.elements.hasOwnProperty(t)?this.elements[t]:new e;return r.forEach((function(e,t){o.set(t,e,i)})),void(this.elements[t]=o)}if(Array.isArray(r)||"object"!==(void 0===r?"undefined":Ni(r)))this.elements[t]=r;else{for(var s=this.elements.hasOwnProperty(t)?this.elements[t]:new e,a=Object.keys(r),l=0;l<a.length;l+=1)s.set(a[l],r[a[l]],i);this.elements[t]=s}}else this.elements[t]=r}},{key:"get",value:function(e){return this.elements[e]}},{key:"has",value:function(e){return this.elements.hasOwnProperty(e)}},{key:"addStyleType",value:function(t){var r=this;if(Ii&&t instanceof Map||t instanceof e)t.forEach((function(e,t){r.set(t,e,!0)}));else for(var i=Object.keys(t),n=0;n<i.length;n++)this.set(i[n],t[i[n]],!0)}}]),e}(),Vi=/([A-Z])/g,ki=function(e){return"-"+String(e.toLowerCase())},Wi={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};var Bi=["Webkit","ms","Moz","O"];Object.keys(Wi).forEach((function(e){Bi.forEach((function(t){Wi[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=Wi[e]}))}));var Hi=function(e,t){return"number"==typeof t?Wi[e]?""+t:t+"px":""+t},Di=function(e,t){return Gi(Hi(e,t))},zi=function(e,r){return t(Yr)(e).toString(36)},Gi=function(e){return"!"===e[e.length-10]&&" !important"===e.slice(-11)?e:String(e)+" !important"};var Ui=t(Xr)(Pi),ji=[function(e,t,r){return":"!==e[0]?null:r(t+e)},function(e,t,r){if("@"!==e[0])return null;var i=r(t);return[String(e)+"{"+String(i.join(""))+"}"]}],$i=function e(t,r,i,n,o){for(var s=new Mi,a=0;a<r.length;a++)s.addStyleType(r[a]);var l=new Mi,c=[];s.forEach((function(r,s){var a=i.some((function(a){var l=a(s,t,(function(t){return e(t,[r],i,n,o)}));if(null!=l)return Array.isArray(l)?c.push.apply(c,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(l)):(console.warn("WARNING: Selector handlers should return an array of rules.Returning a string containing multiple rules is deprecated.",a),c.push("@media all {"+String(l)+"}")),!0}));a||l.set(s,r,!0)}));var h=Xi(t,l,n,o,i);return h&&c.unshift(h),c},Ki=function(e,t,r){return String("m"===(i=e.replace(Vi,ki))[0]&&"s"===i[1]&&"-"===i[2]?"-"+String(i):i)+":"+String(r(e,t))+";";var i},Yi=function(e,t){return e[t]=!0,e},Xi=function(e,t,r,i,n){!function(e,t,r){if(t)for(var i=Object.keys(t),n=0;n<i.length;n++){var o=i[n];e.has(o)&&e.set(o,t[o](e.get(o),r),!1)}}(t,r,n);var o=Object.keys(t.elements).reduce(Yi,Object.create(null)),s=Ui(t.elements),a=Object.keys(s);if(a.length!==t.keyOrder.length)for(var l=0;l<a.length;l++)if(!o[a[l]]){var c=void 0;if((c="W"===a[l][0]?a[l][6].toLowerCase()+a[l].slice(7):"o"===a[l][1]?a[l][3].toLowerCase()+a[l].slice(4):a[l][2].toLowerCase()+a[l].slice(3))&&o[c]){var h=t.keyOrder.indexOf(c);t.keyOrder.splice(h,0,a[l])}else t.keyOrder.unshift(a[l])}for(var u=!1===i?Hi:Di,f=[],d=0;d<t.keyOrder.length;d++){var p=t.keyOrder[d],m=s[p];if(Array.isArray(m))for(var g=0;g<m.length;g++)f.push(Ki(p,m[g],u));else f.push(Ki(p,m,u))}return f.length?String(e)+"{"+String(f.join(""))+"}":""},qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var Zi=null,Qi={fontFamily:function e(t){return Array.isArray(t)?t.map(e).join(","):"object"===(void 0===t?"undefined":qi(t))?(nn(t.src,"@font-face",[t],!1),'"'+String(t.fontFamily)+'"'):t},animationName:function e(t,r){if(Array.isArray(t))return t.map((function(t){return e(t,r)})).join(",");if("object"===(void 0===t?"undefined":qi(t))){var i="keyframe_"+String((o=t,zi(JSON.stringify(o)))),n="@keyframes "+i+"{";return t instanceof Mi?t.forEach((function(e,t){n+=$i(t,[e],r,Qi,!1).join("")})):Object.keys(t).forEach((function(e){n+=$i(e,[t[e]],r,Qi,!1).join("")})),rn(i,[n+="}"]),i}return t;var o}},Ji={},en=[],tn=!1,rn=function(e,r){var i;if(!Ji[e]){if(!tn){if("undefined"==typeof document)throw new Error("Cannot automatically buffer without a document");tn=!0,t(ai)(sn)}(i=en).push.apply(i,function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}(r)),Ji[e]=!0}},nn=function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(!Ji[e]){var o=$i(t,r,n,Qi,i);rn(e,o)}},on=function(){tn=!1;var e=en;return en=[],e},sn=function(){var e=on();e.length>0&&function(e){if(null==Zi&&null==(Zi=document.querySelector("style[data-aphrodite]"))){var t=document.head||document.getElementsByTagName("head")[0];(Zi=document.createElement("style")).type="text/css",Zi.setAttribute("data-aphrodite",""),t.appendChild(Zi)}var r=Zi.styleSheet||Zi.sheet;if(r.insertRule){var i=r.cssRules.length;e.forEach((function(e){try{r.insertRule(e,i),i+=1}catch(e){}}))}else Zi.innerText=(Zi.innerText||"")+e.join("")}(e)},an=function(e){e.forEach((function(e){Ji[e]=!0}))},ln=function e(t,r,i,n){for(var o=0;o<t.length;o+=1)t[o]&&(Array.isArray(t[o])?n+=e(t[o],r,i,n):(r.push(t[o]._name),i.push(t[o]._definition),n+=t[o]._len));return n},cn=function(e,t,r){var i=[],n=[],o=ln(t,i,n,0);if(0===i.length)return"";var s;return s=1===i.length?"_"+String(i[0]):"_"+String(zi(i.join()))+String((o%36).toString(36)),nn(s,"."+String(s),n,e,r),s},hn=function(e,t){return String(t)+"_"+String(zi(e))},un=zi,fn={create:function(e){for(var t={},r=Object.keys(e),i=0;i<r.length;i+=1){var n=r[i],o=e[n],s=JSON.stringify(o);t[n]={_len:s.length,_name:un(s,n),_definition:o}}return t},rehydrate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];an(e)}},dn="undefined"!=typeof window?null:{renderStatic:function(e){return en=[],Ji={},tn=!1,Zi=null,function(){if(tn)throw new Error("Cannot buffer while already buffering");tn=!0}(),{html:e(),css:{content:on().join(""),renderedClassNames:Object.keys(Ji)}}}};var pn=function e(t,r){return{StyleSheet:Object.assign({},fn,{extend:function(i){var n=i.map((function(e){return e.selectorHandler})).filter((function(e){return e}));return e(t,r.concat(n))}}),StyleSheetServer:dn,StyleSheetTestUtils:null,minify:function(e){un=e?zi:hn},css:function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return cn(t,i,r)}}}(!0,ji),mn=pn.StyleSheet,gn=(pn.StyleSheetServer,pn.StyleSheetTestUtils,pn.css);pn.minify;let _n,wn;var vn;let yn;var Sn;let xn,Cn;var Rn;(_n||(_n={})).MONOSPACE="Fira Mono",(vn=wn||(wn={}))[vn.LABEL=10]="LABEL",vn[vn.TITLE=12]="TITLE",vn[vn.BIG_BUTTON=36]="BIG_BUTTON",(Sn=yn||(yn={}))[Sn.MINIMAP_HEIGHT=100]="MINIMAP_HEIGHT",Sn[Sn.DETAIL_VIEW_HEIGHT=150]="DETAIL_VIEW_HEIGHT",Sn[Sn.TOOLTIP_WIDTH_MAX=900]="TOOLTIP_WIDTH_MAX",Sn[Sn.TOOLTIP_HEIGHT_MAX=80]="TOOLTIP_HEIGHT_MAX",Sn[Sn.SEPARATOR_HEIGHT=2]="SEPARATOR_HEIGHT",Sn[Sn.FRAME_HEIGHT=20]="FRAME_HEIGHT",Sn[Sn.TOOLBAR_HEIGHT=20]="TOOLBAR_HEIGHT",Sn[Sn.TOOLBAR_TAB_HEIGHT=18]="TOOLBAR_TAB_HEIGHT",(xn||(xn={})).HOVER_CHANGE="0.07s",(Rn=Cn||(Cn={}))[Rn.PROFILE_SELECT=1]="PROFILE_SELECT",Rn[Rn.HOVERTIP=2]="HOVERTIP";const En=mn.create({fillY:{height:"100%"},fillX:{width:"100%"},hbox:{display:"flex",flexDirection:"row",position:"relative",overflow:"hidden"},vbox:{display:"flex",flexDirection:"column",position:"relative",overflow:"hidden"}});let bn;var Tn;(Tn=bn||(bn={}))[Tn.CHRONO_FLAME_CHART=0]="CHRONO_FLAME_CHART",Tn[Tn.LEFT_HEAVY_FLAME_GRAPH=1]="LEFT_HEAVY_FLAME_GRAPH";class An{constructor(e,t){this.profile=e,this.searchQuery=t,this.matches=null}getMatchForFrame(e){return this.matches||(this.matches=new Map,this.profile.forEachFrame((e=>{const t=function(e,t){const r=e.toLocaleLowerCase(),i=t.toLocaleLowerCase();let n=0;const o=[];for(;;){let e=r.indexOf(i,n);if(-1===e)return o;o.push([e,e+t.length]),n=e+t.length}}(e.name,this.searchQuery);this.matches.set(e,0===t.length?null:t)}))),this.matches.get(e)||null}}class Ln{constructor(e,t){this.flamechart=e,this.profileResults=t,this.matches=null}getResults(){if(null==this.matches){const e=[],t=new Map,r=(i,n)=>{const{node:o}=i;if(this.profileResults.getMatchForFrame(o.frame)){const r=new ee(new Q(i.start,n),new Q(i.end-i.start,1));t.set(o,e.length),e.push({configSpaceBounds:r,node:o})}i.children.forEach((e=>{r(e,n+1)}))},i=this.flamechart.getLayers();i.length>0&&i[0].forEach((e=>r(e,0))),this.matches={matches:e,indexForNode:t}}return this.matches}count(){return this.getResults().matches.length}indexOf(e){const t=this.getResults().indexForNode.get(e);return void 0===t?null:t}at(e){const t=this.getResults().matches;if(e<0||e>=t.length)throw new Error(`Index ${e} out of bounds in list of ${t.length} matches.`);return t[e]}}function Fn(e){e.stopPropagation()}const Pn=k(null),Nn=({children:e})=>{const t=kt(),r=t?t.profile:null,i=dt(yt),n=dt(St),o=De((()=>r&&i&&0!==n.length?new An(r,n):null),[i,n,r]);return w(Pn.Provider,{value:o},e)},On=Ze((({numResults:e,resultIndex:t,selectNext:r,selectPrev:i})=>{const n=Zt(),o=In(n),s=dt(yt),a=dt(St),l=St.set,c=yt.set,h=ze((e=>{const t=e.target.value;l(t)}),[l]),u=He(null),f=ze((()=>c(!1)),[c]),d=ze((e=>{e.shiftKey?i():r()}),[i,r]),p=ze((e=>{e.stopPropagation(),"Escape"===e.key&&c(!1),"Enter"===e.key&&d(e),"f"==e.key&&(e.metaKey||e.ctrlKey)&&(u.current&&u.current.select(),e.preventDefault())}),[c,d]);return We((()=>{const e=e=>{"f"==e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),u.current?u.current.select():(c(!0),requestAnimationFrame((()=>{u.current&&u.current.select()}))))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[c]),s?w("div",{className:gn(o.searchView)},w("span",{className:gn(o.icon)},""),w("span",{className:gn(o.inputContainer)},w("input",{className:gn(o.input),value:a,onInput:h,onKeyDown:p,onKeyUp:Fn,onKeyPress:Fn,ref:u})),null!=e&&w(y,null,w("span",{className:gn(o.resultCount)},null==t?"?":t+1,"/",e),w("button",{className:gn(o.icon,o.button),onClick:i},""),w("button",{className:gn(o.icon,o.button),onClick:r},"")),w("svg",{className:gn(o.icon),onClick:f,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},w("path",{d:"M4.99999 4.16217L11.6427 10.8048M11.6427 4.16217L4.99999 10.8048",stroke:n.altFgSecondaryColor}))):null})),In=Qt((e=>mn.create({searchView:{position:"absolute",top:0,right:10,height:yn.TOOLBAR_HEIGHT,width:208,borderWidth:2,borderColor:e.altFgPrimaryColor,borderStyle:"solid",fontSize:wn.LABEL,boxSizing:"border-box",background:e.altBgSecondaryColor,color:e.altFgPrimaryColor,display:"flex",alignItems:"center"},inputContainer:{flexShrink:1,flexGrow:1,display:"flex"},input:{width:"100%",border:"none",background:"none",fontSize:wn.LABEL,lineHeight:`${yn.TOOLBAR_HEIGHT}px`,color:e.altFgPrimaryColor,":focus":{border:"none",outline:"none"},"::selection":{color:e.altFgPrimaryColor,background:e.selectionPrimaryColor}},resultCount:{verticalAlign:"middle"},icon:{flexShrink:0,verticalAlign:"middle",height:"100%",margin:"0px 2px 0px 2px",fontSize:wn.LABEL},button:{display:"inline",background:"none",border:"none",padding:0,":focus":{outline:"none"}}})));class Mn{unit="none";format(e){return e.toLocaleString()}}const Vn=o("l3kj8");class kn{selfWeight=0;totalWeight=0;getSelfWeight(){return this.selfWeight}getTotalWeight(){return this.totalWeight}addToTotalWeight(e){this.totalWeight+=e}addToSelfWeight(e){this.selfWeight+=e}overwriteWeightWith(e){this.selfWeight=e.selfWeight,this.totalWeight=e.totalWeight}}class Wn extends kn{constructor(e){super(),this.color_key=e.color_key,this.key=e.key,this.name=e.name,this.file=e.file,this.line=e.line,this.col=e.col}static root=new Wn({color_key:"Root",key:"(speedscope root)",name:"(speedscope root)"});static getOrInsert(e,t){return e.getOrInsert(new Wn(t))}}class Bn extends kn{isRoot(){return this.frame===Wn.root}isFrozen(){return this.frozen}freeze(){this.frozen=!0}constructor(e,t){super(),this.frame=e,this.parent=t,this.children=[],this.frozen=!1}}class Hn{name="";frames=new H;appendOrderCalltreeRoot=new Bn(Wn.root,null);groupedCalltreeRoot=new Bn(Wn.root,null);getAppendOrderCalltreeRoot(){return this.appendOrderCalltreeRoot}getGroupedCalltreeRoot(){return this.groupedCalltreeRoot}samples=[];weights=[];valueFormatter=new Mn;constructor(e=0){this.totalWeight=e}shallowClone(){const e=new Hn(this.totalWeight);return Object.assign(e,this),e}formatValue(e){return this.valueFormatter.format(e)}setValueFormatter(e){this.valueFormatter=e}getWeightUnit(){return this.valueFormatter.unit}getName(){return this.name}setName(e){this.name=e}getTotalWeight(){return this.totalWeight}totalNonIdleWeight=null;getTotalNonIdleWeight(){return null===this.totalNonIdleWeight&&(this.totalNonIdleWeight=this.groupedCalltreeRoot.children.reduce(((e,t)=>e+t.getTotalWeight()),0)),this.totalNonIdleWeight}sortGroupedCallTree(){!function e(t){t.children.sort(((e,t)=>-(e.getTotalWeight()-t.getTotalWeight()))),t.children.forEach(e)}(this.groupedCalltreeRoot)}forEachCallGrouped(e,t){!function r(i,n){i.frame!==Wn.root&&e(i,n);let o=0;i.children.forEach((function(e){r(e,n+o),o+=e.getTotalWeight()})),i.frame!==Wn.root&&t(i,n+i.getTotalWeight())}(this.groupedCalltreeRoot,0)}forEachCall(e,t){let r=[],i=0,n=0;for(let o of this.samples){let s=null;for(s=o;s&&s.frame!=Wn.root&&-1===r.indexOf(s);s=s.parent);for(;r.length>0&&W(r)!=s;){t(r.pop(),i)}const a=[];for(let e=o;e&&e.frame!=Wn.root&&e!=s;e=e.parent)a.push(e);a.reverse();for(let t of a)e(t,i);r=r.concat(a),i+=this.weights[n++]}for(let e=r.length-1;e>=0;e--)t(r[e],i)}forEachFrame(e){this.frames.forEach(e)}getInvertedProfileForCallersOf(e){const t=Wn.getOrInsert(this.frames,e),r=new Dn,i=[];!function e(r){if(r.frame===t)i.push(r);else for(let t of r.children)e(t)}(this.appendOrderCalltreeRoot);for(let e of i){const t=[];for(let r=e;null!=r&&r.frame!==Wn.root;r=r.parent)t.push(r.frame);r.appendSampleWithWeight(t,e.getTotalWeight())}const n=r.build();return n.name=this.name,n.valueFormatter=this.valueFormatter,n}getProfileForCalleesOf(e){const t=Wn.getOrInsert(this.frames,e),r=new Dn;!function e(i){if(i.frame===t)!function(e){const t=[];!function e(i){t.push(i.frame),r.appendSampleWithWeight(t,i.getSelfWeight());for(let t of i.children)e(t);t.pop()}(e)}(i);else for(let t of i.children)e(t)}(this.appendOrderCalltreeRoot);const i=r.build();return i.name=this.name,i.valueFormatter=this.valueFormatter,i}async demangle(){let e=null;for(let t of this.frames)t.name.startsWith("__Z")&&(e||(e=(await Vn).demangleCpp),t.name=e(t.name))}remapSymbols(e){for(let t of this.frames){const r=e(t);if(null==r)continue;const{name:i,file:n,line:o,col:s}=r;null!=i&&(t.name=i),null!=n&&(t.file=n),null!=o&&(t.line=o),null!=s&&(t.col=s)}}}class Dn extends Hn{_appendSample(e,t,r){if(isNaN(t))throw new Error("invalid weight");let i=r?this.appendOrderCalltreeRoot:this.groupedCalltreeRoot,n=new Set;for(let o of e){const e=Wn.getOrInsert(this.frames,o),s=r?W(i.children):i.children.find((t=>t.frame===e));if(s&&!s.isFrozen()&&s.frame==e)i=s;else{const t=i;i=new Bn(e,i),t.children.push(i)}i.addToTotalWeight(t),n.add(i.frame)}if(i.addToSelfWeight(t),r)for(let e of i.children)e.freeze();if(r){i.frame.addToSelfWeight(t);for(let e of n)e.addToTotalWeight(t);i===W(this.samples)?this.weights[this.weights.length-1]+=t:(this.samples.push(i),this.weights.push(t))}}appendSampleWithWeight(e,t){if(0!==t){if(t<0)throw new Error("Samples must have positive weights");this._appendSample(e,t,!0),this._appendSample(e,t,!1)}}pendingSample=null;appendSampleWithTimestamp(e,t){if(this.pendingSample){if(t<this.pendingSample.centralTimestamp)throw new Error("Timestamps received out of order");const r=(t+this.pendingSample.centralTimestamp)/2;this.appendSampleWithWeight(this.pendingSample.stack,r-this.pendingSample.startTimestamp),this.pendingSample={stack:e,startTimestamp:r,centralTimestamp:t}}else this.pendingSample={stack:e,startTimestamp:t,centralTimestamp:t}}build(){return this.pendingSample&&(this.samples.length>0?this.appendSampleWithWeight(this.pendingSample.stack,this.pendingSample.centralTimestamp-this.pendingSample.startTimestamp):(this.appendSampleWithWeight(this.pendingSample.stack,1),this.setValueFormatter(new Mn))),this.totalWeight=Math.max(this.totalWeight,this.weights.reduce(((e,t)=>e+t),0)),this.sortGroupedCallTree(),this}}function zn(e){const t=Gn(Zt());return w("span",{className:gn(t.stackChit),style:{backgroundColor:e.color}})}const Gn=Qt((e=>mn.create({stackChit:{position:"relative",top:-1,display:"inline-block",verticalAlign:"middle",marginRight:"0.5em",border:`1px solid ${e.fgSecondaryColor}`,width:wn.LABEL-2,height:wn.LABEL-2}}))),Un=({items:e,axis:t,renderItems:r,className:i,initialIndexInView:n})=>{const[o,s]=Ve(null),[a,l]=Ve(0),c=He(null),h="x"===t?"width":"height",u="x"===t?"left":"top",f="x"===t?"scrollLeft":"scrollTop",d=He(n?e.reduce(((e,t,r)=>r<n?e+t.size:e),0):0),p=ze((e=>{e?requestAnimationFrame((()=>{s(e.getBoundingClientRect()[h]),null!=d.current&&(e.scrollTo({[u]:d.current}),d.current=null)})):s(null),c.current=e}),[s,h,u]),m=De((()=>{if(null==c.current||null==o||null==a)return null;const t=a-o/4,r=a+o+o/4;let i=0,n=0,s=0;for(;s<e.length;s++){if(n=i,i+=e[s].size,i>=t)break}const l=s;for(;s<e.length;s++){if(i+=e[s].size,i>=r)break}return{firstVisibleIndex:l,lastVisibleIndex:Math.min(s,e.length-1),invisiblePrefixSize:n}}),[o,a,e]),g=De((()=>e.reduce(((e,t)=>e+t.size),0)),[e]),_=ze((()=>{null!=c.current&&l(c.current[f])}),[f]);We((()=>{const e=()=>{null!=c.current&&s(c.current.getBoundingClientRect()[h])};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[h]);const v=De((()=>m?r(m.firstVisibleIndex,m.lastVisibleIndex):null),[r,m]);return w("div",{className:i,ref:p,onScroll:_},De((()=>w("div",{style:{height:g}},w("div",{style:{transform:`translateY(${m?.invisiblePrefixSize||0}px)`}},v))),[m,v,g]))};function jn(e){const t=Xn(Zt());return w("div",{className:gn(t.hBarDisplay)},w("div",{className:gn(t.hBarDisplayFilled),style:{width:`${e.perc}%`}}))}function $n(e){const t=Zt(),r=Xn(t),{activeDirection:i}=e,n=i===It.ASCENDING?t.fgPrimaryColor:t.fgSecondaryColor,o=i===It.DESCENDING?t.fgPrimaryColor:t.fgSecondaryColor;return w("svg",{width:"8",height:"10",viewBox:"0 0 8 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:gn(r.sortIcon)},w("path",{d:"M0 4L4 0L8 4H0Z",fill:n}),w("path",{d:"M0 4L4 0L8 4H0Z",transform:"translate(0 10) scale(1 -1)",fill:o}))}const Kn=({frame:e,matchedRanges:t,profile:r,index:i,selectedFrame:n,setSelectedFrame:o,getCSSColorForFrame:s})=>{const a=Xn(Zt()),l=e.getTotalWeight(),c=e.getSelfWeight(),h=100*l/r.getTotalNonIdleWeight(),u=100*c/r.getTotalNonIdleWeight(),f=e===n;return w("tr",{key:`${i}`,onClick:o.bind(null,e),className:gn(a.tableRow,i%2==0&&a.tableRowEven,f&&a.tableRowSelected)},w("td",{className:gn(a.numericCell)},r.formatValue(l)," (",D(h),")",w(jn,{perc:h})),w("td",{className:gn(a.numericCell)},r.formatValue(c)," (",D(u),")",w(jn,{perc:u})),w("td",{title:e.file,className:gn(a.textCell)},w(zn,{color:s(e)}),t?function(e,t,r){const i=[];let n=0;for(let o of t)i.push(e.slice(n,o[0])),i.push(w("span",{className:r},e.slice(o[0],o[1]))),n=o[1];return i.push(e.slice(n)),w("span",null,i)}(e.name,t,gn(a.matched,f&&a.matchedSelected)):e.name))},Yn=Ze((({profile:e,sortMethod:t,setSortMethod:r,selectedFrame:i,setSelectedFrame:n,getCSSColorForFrame:o,searchQuery:s,searchIsActive:a})=>{const l=Xn(Zt()),c=ze(((e,i)=>{if(i.preventDefault(),t.field==e)r({field:e,direction:t.direction===It.ASCENDING?It.DESCENDING:It.ASCENDING});else switch(e){case Nt.SYMBOL_NAME:r({field:e,direction:It.ASCENDING});break;case Nt.SELF:case Nt.TOTAL:r({field:e,direction:It.DESCENDING})}}),[t,r]),h=Ge(qo),u=ze(((t,r)=>{if(!h)return null;const c=[];for(let s=t;s<=r;s++){const t=h.rowList[s],r=h.getSearchMatchForFrame(t);c.push(Kn({frame:t,matchedRanges:null==r?null:r,index:s,profile:e,selectedFrame:i,setSelectedFrame:n,getCSSColorForFrame:o}))}return 0===c.length&&(a?c.push(w("tr",null,w("td",{className:gn(l.emptyState)},'No symbol names match query "',s,'".'))):c.push(w("tr",null,w("td",{className:gn(l.emptyState)},"No symbols found.")))),w("table",{className:gn(l.tableView)},c)}),[h,e,i,n,o,a,s,l.emptyState,l.tableView]),f=De((()=>null==h?[]:h.rowList.map((e=>({size:yn.FRAME_HEIGHT})))),[h]),d=ze((e=>c(Nt.TOTAL,e)),[c]),p=ze((e=>c(Nt.SELF,e)),[c]),m=ze((e=>c(Nt.SYMBOL_NAME,e)),[c]);return w("div",{className:gn(En.vbox,l.profileTableView)},w("table",{className:gn(l.tableView)},w("thead",{className:gn(l.tableHeader)},w("tr",null,w("th",{className:gn(l.numericCell),onClick:d},w($n,{activeDirection:t.field===Nt.TOTAL?t.direction:null}),"Total"),w("th",{className:gn(l.numericCell),onClick:p},w($n,{activeDirection:t.field===Nt.SELF?t.direction:null}),"Self"),w("th",{className:gn(l.textCell),onClick:m},w($n,{activeDirection:t.field===Nt.SYMBOL_NAME?t.direction:null}),"Symbol Name")))),w(Un,{axis:"y",items:f,className:gn(l.scrollView),renderItems:u,initialIndexInView:null==i?null:h?.getIndexForFrame(i)}))})),Xn=Qt((e=>mn.create({profileTableView:{background:e.bgPrimaryColor,height:"100%"},scrollView:{overflowY:"auto",overflowX:"hidden",flexGrow:1,"::-webkit-scrollbar":{background:e.bgPrimaryColor},"::-webkit-scrollbar-thumb":{background:e.fgSecondaryColor,borderRadius:20,border:`3px solid ${e.bgPrimaryColor}`,":hover":{background:e.fgPrimaryColor}}},tableView:{width:"100%",fontSize:wn.LABEL,background:e.bgPrimaryColor},tableHeader:{borderBottom:`2px solid ${e.bgSecondaryColor}`,textAlign:"left",color:e.fgPrimaryColor,userSelect:"none"},sortIcon:{position:"relative",top:1,marginRight:yn.FRAME_HEIGHT/4},tableRow:{background:e.bgPrimaryColor,height:yn.FRAME_HEIGHT},tableRowEven:{background:e.bgSecondaryColor},tableRowSelected:{background:e.selectionPrimaryColor,color:e.altFgPrimaryColor},numericCell:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",position:"relative",textAlign:"right",paddingRight:yn.FRAME_HEIGHT,width:6*yn.FRAME_HEIGHT,minWidth:6*yn.FRAME_HEIGHT},textCell:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",width:"100%",maxWidth:0},hBarDisplay:{position:"absolute",background:he.fromCSSHex(e.weightColor).withAlpha(.2).toCSS(),bottom:2,height:2,width:`calc(100% - ${2*yn.FRAME_HEIGHT}px)`,right:yn.FRAME_HEIGHT},hBarDisplayFilled:{height:"100%",position:"absolute",background:e.weightColor,right:0},matched:{borderBottom:`2px solid ${e.fgPrimaryColor}`},matchedSelected:{borderColor:e.altFgPrimaryColor},emptyState:{textAlign:"center",fontWeight:"bold"}}))),qn=Ze((e=>{const{activeProfileState:t}=e,{profile:r,sandwichViewState:i}=t;if(!r)throw new Error("profile missing");const n=dt(Vt),o=Zt(),{callerCallee:s}=i,a=s?s.selectedFrame:null,l=Ee(r),c=Se({theme:o,frameToColorBucket:l}),h=ze((e=>{Ct.setSelectedFrame(e)}),[]),u=dt(yt),f=dt(St);return w(Yn,{profile:r,selectedFrame:a,getCSSColorForFrame:c,sortMethod:n,setSelectedFrame:h,setSortMethod:Vt.set,searchIsActive:u,searchQuery:f})}));class Zn{getTotalWeight(){return this.totalWeight}getLayers(){return this.layers}getColorBucketForFrame(e){return this.source.getColorBucketForFrame(e)}getMinFrameWidth(){return this.minFrameWidth}formatValue(e){return this.source.formatValue(e)}getClampedViewportWidth(e){const t=this.getTotalWeight(),r=Math.pow(2,40),i=Z(3*this.getMinFrameWidth(),t/r,t);return Z(e,i,t)}getClampedConfigSpaceViewportRect({configSpaceViewportRect:e,renderInverted:t}){const r=new Q(this.getTotalWeight(),this.getLayers().length),i=this.getClampedViewportWidth(e.size.x),n=e.size.withX(i),o=Q.clamp(e.origin,new Q(0,t?0:-1),Q.max(Q.zero,r.minus(n).plus(new Q(0,1))));return new ee(o,e.size.withX(i))}constructor(e){this.source=e,this.layers=[],this.totalWeight=0,this.minFrameWidth=1;const t=[];this.minFrameWidth=1/0;this.totalWeight=e.getTotalWeight(),e.forEachCall(((e,r)=>{const i=W(t),n={node:e,parent:i,children:[],start:r,end:r};i&&i.children.push(n),t.push(n)}),((e,r)=>{console.assert(t.length>0);const i=t.pop();if(i.end=r,i.end-i.start==0)return;const n=t.length;for(;this.layers.length<=n;)this.layers.push([]);this.layers[n].push(i),this.minFrameWidth=Math.min(this.minFrameWidth,i.end-i.start)})),isFinite(this.minFrameWidth)||(this.minFrameWidth=1)}}class Qn{constructor(e,t,r){this.batch=e,this.bounds=t,this.numPrecedingRectanglesInRow=r,this.children=[]}getBatch(){return this.batch}getBounds(){return this.bounds}getRectCount(){return this.batch.getRectCount()}getChildren(){return this.children}getParity(){return this.numPrecedingRectanglesInRow%2}forEachLeafNodeWithinBounds(e,t){this.bounds.hasIntersectionWith(e)&&t(this)}}class Jn{constructor(e){if(this.children=e,this.rectCount=0,0===e.length)throw new Error("Empty interior node");let t=1/0,r=-1/0,i=1/0,n=-1/0;for(let o of e){this.rectCount+=o.getRectCount();const e=o.getBounds();t=Math.min(t,e.left()),r=Math.max(r,e.right()),i=Math.min(i,e.top()),n=Math.max(n,e.bottom())}this.bounds=new ee(new Q(t,i),new Q(r-t,n-i))}getBounds(){return this.bounds}getRectCount(){return this.rectCount}getChildren(){return this.children}forEachLeafNodeWithinBounds(e,t){if(this.bounds.hasIntersectionWith(e))for(let r of this.children)r.forEachLeafNodeWithinBounds(e,t)}}class eo{get key(){return`${this.stackDepth}_${this.index}_${this.zoomLevel}`}constructor(e){this.stackDepth=e.stackDepth,this.zoomLevel=e.zoomLevel,this.index=e.index}static getOrInsert(e,t){return e.getOrInsert(new eo(t))}}class to{constructor(e,t,r,i,n,o={inverted:!1}){this.gl=e,this.rowAtlas=t,this.flamechart=r,this.rectangleBatchRenderer=i,this.colorPassRenderer=n,this.options=o,this.layers=[],this.rectInfoTexture=null,this.rectInfoRenderTarget=null,this.atlasKeys=new H;const s=r.getLayers().length;for(let e=0;e<s;e++){const t=[],i=o.inverted?s-1-e:e;let n=1/0,a=-1/0,l=new le(this.gl),c=0;const h=r.getLayers()[e];for(let r=0;r<h.length;r++){const o=h[r];l.getRectCount()>=1e4&&(t.push(new Qn(l,new ee(new Q(n,i),new Q(a-n,1)),c)),n=1/0,a=-1/0,l=new le(this.gl));const s=new ee(new Q(o.start,i),new Q(o.end-o.start,1));n=Math.min(n,s.left()),a=Math.max(a,s.right());const u=new he((1+r%255)/256,(1+e%255)/256,(1+this.flamechart.getColorBucketForFrame(o.node.frame))/256);l.addRect(s,u),c++}l.getRectCount()>0&&t.push(new Qn(l,new ee(new Q(n,i),new Q(a-n,1)),c)),this.layers.push(new Jn(t))}}getRectInfoTexture(e,t){if(this.rectInfoTexture){const r=this.rectInfoTexture;r.width==e&&r.height==t||r.resize(e,t)}else this.rectInfoTexture=this.gl.createTexture(re.TextureFormat.NEAREST_CLAMP,e,t);return this.rectInfoTexture}getRectInfoRenderTarget(e,t){const r=this.getRectInfoTexture(e,t);return this.rectInfoRenderTarget&&this.rectInfoRenderTarget.texture!=r&&(this.rectInfoRenderTarget.texture.free(),this.rectInfoRenderTarget.setColor(r)),this.rectInfoRenderTarget||(this.rectInfoRenderTarget=this.gl.createRenderTarget(r)),this.rectInfoRenderTarget}free(){this.rectInfoRenderTarget&&this.rectInfoRenderTarget.free(),this.rectInfoTexture&&this.rectInfoTexture.free()}configSpaceBoundsForKey(e){const{stackDepth:t,zoomLevel:r,index:i}=e,n=this.flamechart.getTotalWeight()/Math.pow(2,r),o=this.flamechart.getLayers().length,s=this.options.inverted?o-1-t:t;return new ee(new Q(n*i,s),new Q(n,1))}render(e){const{configSpaceSrcRect:t,physicalSpaceDstRect:r}=e,i=[],n=J.betweenRects(t,r);if(t.isEmpty())return;let o=0;for(;;){const e=eo.getOrInsert(this.atlasKeys,{stackDepth:0,zoomLevel:o,index:0}),t=this.configSpaceBoundsForKey(e);if(n.transformRect(t).width()<this.rowAtlas.getResolution())break;o++}const s=Math.max(0,Math.floor(t.top())),a=Math.min(this.layers.length,Math.ceil(t.bottom())),l=this.flamechart.getTotalWeight(),c=Math.pow(2,o),h=Math.floor(c*t.left()/l),u=Math.ceil(c*t.right()/l),f=this.flamechart.getLayers().length;for(let e=s;e<a;e++)for(let r=h;r<=u;r++){const n=this.options.inverted?f-1-e:e,s=eo.getOrInsert(this.atlasKeys,{stackDepth:n,zoomLevel:o,index:r});this.configSpaceBoundsForKey(s).hasIntersectionWith(t)&&i.push(s)}const d=this.rowAtlas.getCapacity(),p=i.slice(0,d),m=i.slice(d);this.rowAtlas.writeToAtlasIfNeeded(p,((e,t)=>{const r=this.configSpaceBoundsForKey(t);this.layers[t.stackDepth].forEachLeafNodeWithinBounds(r,(t=>{this.rectangleBatchRenderer.render({batch:t.getBatch(),configSpaceSrcRect:r,physicalSpaceDstRect:e})}))}));const g=this.getRectInfoRenderTarget(r.width(),r.height());se(this.gl,g,(()=>{this.gl.clear(new re.Color(0,0,0,0));const e=new ee(Q.zero,new Q(this.gl.viewport.width,this.gl.viewport.height)),r=J.betweenRects(t,e);for(let e of p){const t=this.configSpaceBoundsForKey(e);this.rowAtlas.renderViaAtlas(e,r.transformRect(t))}for(let e of m){const t=this.configSpaceBoundsForKey(e),i=r.transformRect(t);this.layers[e.stackDepth].forEachLeafNodeWithinBounds(t,(e=>{this.rectangleBatchRenderer.render({batch:e.getBatch(),configSpaceSrcRect:t,physicalSpaceDstRect:i})}))}}));const _=this.getRectInfoTexture(r.width(),r.height());this.colorPassRenderer.render({rectInfoTexture:_,srcRect:new ee(Q.zero,new Q(_.width,_.height)),dstRect:r,renderOutlines:e.renderOutlines})}}const ro=Qt((e=>mn.create({hoverCount:{color:e.weightColor},fill:{width:"100%",height:"100%",position:"absolute",left:0,top:0},minimap:{height:yn.MINIMAP_HEIGHT,borderBottom:`${yn.SEPARATOR_HEIGHT}px solid ${e.fgSecondaryColor}`},panZoomView:{flex:1},detailView:{display:"grid",height:yn.DETAIL_VIEW_HEIGHT,overflow:"hidden",gridTemplateColumns:"120px 120px 1fr",gridTemplateRows:"repeat(4, 1fr)",borderTop:`${yn.SEPARATOR_HEIGHT}px solid ${e.fgSecondaryColor}`,fontSize:wn.LABEL,position:"absolute",background:e.bgPrimaryColor,width:"100vw",bottom:0},stackTraceViewPadding:{padding:5},stackTraceView:{height:yn.DETAIL_VIEW_HEIGHT,lineHeight:`${wn.LABEL+2}px`,overflow:"auto","::-webkit-scrollbar":{background:e.bgPrimaryColor},"::-webkit-scrollbar-thumb":{background:e.fgSecondaryColor,borderRadius:20,border:`3px solid ${e.bgPrimaryColor}`,":hover":{background:e.fgPrimaryColor}}},stackLine:{whiteSpace:"nowrap"},stackFileLine:{color:e.fgSecondaryColor},statsTable:{display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:`repeat(3, ${wn.LABEL+10}px)`,gridGap:"1px 1px",textAlign:"center",paddingRight:1},statsTableHeader:{gridColumn:"1 / 3"},statsTableCell:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},thisInstanceCell:{background:e.selectionPrimaryColor,color:e.altFgPrimaryColor},allInstancesCell:{background:e.selectionSecondaryColor,color:e.altFgPrimaryColor},barDisplay:{position:"absolute",top:0,left:0,background:"rgba(0, 0, 0, 0.2)",width:"100%"}}))),io=new Map;let no,oo=-1;function so(e,t){return window.devicePixelRatio!==oo&&(io.clear(),oo=window.devicePixelRatio),io.has(t)||io.set(t,e.measureText(t).width),io.get(t)}function ao(e,t){if(e.length<=t)return{trimmedString:e,trimmedLength:e.length,prefixLength:e.length,suffixLength:0,originalString:e,originalLength:e.length};let r=Math.floor(t/2);const i=t-r-1,n=e.substr(0,r),o=e.substr(e.length-i,i),s=n+""+o;return{trimmedString:s,trimmedLength:s.length,prefixLength:n.length,suffixLength:o.length,originalString:e,originalLength:e.length}}function lo(e,t,r){if(so(e,t)<=r)return ao(t,t.length);const[i]=G(0,t.length,(r=>so(e,ao(t,r).trimmedString)),r);return ao(t,i)}var co;function ho(e,t){return t<e.prefixLength?no.IN_PREFIX:t<e.originalLength-e.suffixLength?no.ELIDED:no.IN_SUFFIX}function uo(e,t){const r=[],i=e.originalLength-e.trimmedLength;let n=!1;for(let[o,s]of t){let t=ho(e,o),a=ho(e,s-1);switch(t){case no.IN_PREFIX:switch(a){case no.IN_PREFIX:r.push([o,s]);break;case no.ELIDED:r.push([o,e.prefixLength+1]),n=!0;break;case no.IN_SUFFIX:r.push([o,s-i])}break;case no.ELIDED:switch(a){case no.IN_PREFIX:throw new Error("Unexpected highlight range starts in elided and ends in prefix");case no.ELIDED:n||(r.push([e.prefixLength,e.prefixLength+1]),n=!0);break;case no.IN_SUFFIX:n?r.push([e.trimmedLength-e.suffixLength,s-i]):(r.push([e.prefixLength,s-i]),n=!0)}break;case no.IN_SUFFIX:switch(a){case no.IN_PREFIX:throw new Error("Unexpected highlight range starts in suffix and ends in prefix");case no.ELIDED:throw new Error("Unexpected highlight range starts in suffix and ends in elided");case no.IN_SUFFIX:r.push([o-i,s-i])}}}return r}let fo;var po;(co=no||(no={}))[co.IN_PREFIX=0]="IN_PREFIX",co[co.IN_SUFFIX=1]="IN_SUFFIX",co[co.ELIDED=2]="ELIDED",(po=fo||(fo={}))[po.DRAW_NEW_VIEWPORT=0]="DRAW_NEW_VIEWPORT",po[po.TRANSLATE_VIEWPORT=1]="TRANSLATE_VIEWPORT";class mo extends S{container=null;containerRef=e=>{this.container=e||null};overlayCanvas=null;overlayCtx=null;physicalViewSize(){return new Q(this.overlayCanvas?this.overlayCanvas.width:0,this.overlayCanvas?this.overlayCanvas.height:0)}getStyle(){return ro(this.props.theme)}minimapOrigin(){return new Q(0,yn.FRAME_HEIGHT*window.devicePixelRatio)}configSpaceSize(){return new Q(this.props.flamechart.getTotalWeight(),this.props.flamechart.getLayers().length)}configSpaceToPhysicalViewSpace(){const e=this.minimapOrigin();return J.betweenRects(new ee(new Q(0,0),this.configSpaceSize()),new ee(e,this.physicalViewSize().minus(e)))}logicalToPhysicalViewSpace(){return J.withScale(new Q(window.devicePixelRatio,window.devicePixelRatio))}windowToLogicalViewSpace(){if(!this.container)return new J;const e=this.container.getBoundingClientRect();return J.withTranslation(new Q(-e.left,-e.top))}renderRects(){this.container&&(this.physicalViewSize().x<2||this.props.canvasContext.renderBehind(this.container,(()=>{this.props.flamechartRenderer.render({configSpaceSrcRect:new ee(new Q(0,0),this.configSpaceSize()),physicalSpaceDstRect:new ee(this.minimapOrigin(),this.physicalViewSize().minus(this.minimapOrigin())),renderOutlines:!1}),this.props.canvasContext.viewportRectangleRenderer.render({configSpaceViewportRect:this.props.configSpaceViewportRect,configSpaceToPhysicalViewSpace:this.configSpaceToPhysicalViewSpace()})})))}renderOverlays(){const e=this.overlayCtx;if(!e)return;const t=this.physicalViewSize();e.clearRect(0,0,t.x,t.y);const r=this.configSpaceToPhysicalViewSpace(),i=this.configSpaceSize().x,n=(this.configSpaceToPhysicalViewSpace().inverted()||new J).times(this.logicalToPhysicalViewSpace()).transformVector(new Q(200,1)).x,o=yn.FRAME_HEIGHT*window.devicePixelRatio,s=wn.LABEL*window.devicePixelRatio,a=(o-s)/2;e.font=`${s}px/${o}px ${_n.MONOSPACE}`,e.textBaseline="top";let l=Math.pow(10,Math.floor(Math.log10(n)));n/l>5?l*=5:n/l>2&&(l*=2);const c=this.props.theme;e.fillStyle=he.fromCSSHex(c.bgPrimaryColor).withAlpha(.8).toCSS(),e.fillRect(0,0,t.x,o),e.textBaseline="top";for(let n=Math.ceil(0/l)*l;n<i;n+=l){const i=Math.round(r.transformPosition(new Q(n,0)).x),o=this.props.flamechart.formatValue(n),s=Math.ceil(so(e,o));e.fillStyle=c.fgPrimaryColor,e.fillText(o,i-s-a,a),e.fillStyle=c.fgSecondaryColor,e.fillRect(i,0,1,t.y)}}onWindowResize=()=>{this.onBeforeFrame()};componentWillReceiveProps(e){this.props.flamechart!==e.flamechart||this.props.configSpaceViewportRect!=e.configSpaceViewportRect?this.renderCanvas():this.props.canvasContext!==e.canvasContext&&(this.props.canvasContext&&this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame),e.canvasContext&&(e.canvasContext.addBeforeFrameHandler(this.onBeforeFrame),e.canvasContext.requestFrame()))}componentDidMount(){window.addEventListener("resize",this.onWindowResize),this.props.canvasContext.addBeforeFrameHandler(this.onBeforeFrame)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize),this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame)}resizeOverlayCanvasIfNeeded(){if(!this.overlayCanvas)return;let{width:e,height:t}=this.overlayCanvas.getBoundingClientRect();if(e=Math.floor(e),t=Math.floor(t),0===e||0===t)return;const r=e*window.devicePixelRatio,i=t*window.devicePixelRatio;r===this.overlayCanvas.width&&i===this.overlayCanvas.height||(this.overlayCanvas.width=r,this.overlayCanvas.height=i)}onBeforeFrame=()=>{this.maybeClearInteractionLock(),this.resizeOverlayCanvasIfNeeded(),this.renderRects(),this.renderOverlays()};renderCanvas=()=>{this.props.canvasContext.requestFrame()};frameHadWheelEvent=!1;framesWithoutWheelEvents=0;interactionLock=null;maybeClearInteractionLock=()=>{this.interactionLock&&(this.frameHadWheelEvent||(this.framesWithoutWheelEvents++,this.framesWithoutWheelEvents>=2&&(this.interactionLock=null,this.framesWithoutWheelEvents=0)),this.props.canvasContext.requestFrame()),this.frameHadWheelEvent=!1};pan(e){this.interactionLock="pan";const t=this.logicalToPhysicalViewSpace().transformVector(e),r=this.configSpaceToPhysicalViewSpace().inverseTransformVector(t);r&&this.props.transformViewport(J.withTranslation(r))}zoom(e){this.interactionLock="zoom";const t=this.props.configSpaceViewportRect,r=t.origin.plus(t.size.times(.5));if(!r)return;const i=J.withTranslation(r.times(-1)).scaledBy(new Q(e,1)).translatedBy(r);this.props.transformViewport(i)}onWheel=e=>{e.preventDefault(),this.frameHadWheelEvent=!0;if((e.metaKey||e.ctrlKey)&&"pan"!==this.interactionLock){let t=1+e.deltaY/100;e.ctrlKey&&(t=1+e.deltaY/40),t=Z(t,.1,10),this.zoom(t)}else"zoom"!==this.interactionLock&&this.pan(new Q(e.deltaX,e.deltaY));this.renderCanvas()};configSpaceMouse(e){const t=this.windowToLogicalViewSpace().transformPosition(new Q(e.clientX,e.clientY)),r=this.logicalToPhysicalViewSpace().transformPosition(t);return this.configSpaceToPhysicalViewSpace().inverseTransformPosition(r)}dragStartConfigSpaceMouse=null;dragConfigSpaceViewportOffset=null;draggingMode=null;onMouseDown=e=>{const t=this.configSpaceMouse(e);t&&(this.props.configSpaceViewportRect.contains(t)?(this.draggingMode=fo.TRANSLATE_VIEWPORT,this.dragConfigSpaceViewportOffset=t.minus(this.props.configSpaceViewportRect.origin)):this.draggingMode=fo.DRAW_NEW_VIEWPORT,this.dragStartConfigSpaceMouse=t,window.addEventListener("mousemove",this.onWindowMouseMove),window.addEventListener("mouseup",this.onWindowMouseUp),this.updateCursor(t))};onWindowMouseMove=e=>{if(!this.dragStartConfigSpaceMouse)return;let t=this.configSpaceMouse(e);if(t)if(this.updateCursor(t),t=new ee(new Q(0,0),this.configSpaceSize()).closestPointTo(t),this.draggingMode===fo.DRAW_NEW_VIEWPORT){const e=this.dragStartConfigSpaceMouse;let r=t;if(!e||!r)return;const i=Math.min(e.x,r.x),n=Math.max(e.x,r.x)-i,o=this.props.configSpaceViewportRect.height();this.props.setConfigSpaceViewportRect(new ee(new Q(i,r.y-o/2),new Q(n,o)))}else if(this.draggingMode===fo.TRANSLATE_VIEWPORT){if(!this.dragConfigSpaceViewportOffset)return;const e=t.minus(this.dragConfigSpaceViewportOffset);this.props.setConfigSpaceViewportRect(this.props.configSpaceViewportRect.withOrigin(e))}};updateCursor=e=>{this.draggingMode===fo.TRANSLATE_VIEWPORT?(document.body.style.cursor="grabbing",document.body.style.cursor="-webkit-grabbing"):this.draggingMode===fo.DRAW_NEW_VIEWPORT?document.body.style.cursor="col-resize":this.props.configSpaceViewportRect.contains(e)?(document.body.style.cursor="grab",document.body.style.cursor="-webkit-grab"):document.body.style.cursor="col-resize"};onMouseLeave=()=>{null==this.draggingMode&&(document.body.style.cursor="default")};onMouseMove=e=>{const t=this.configSpaceMouse(e);t&&this.updateCursor(t)};onWindowMouseUp=e=>{this.draggingMode=null,window.removeEventListener("mousemove",this.onWindowMouseMove),window.removeEventListener("mouseup",this.onWindowMouseUp);const t=this.configSpaceMouse(e);t&&this.updateCursor(t)};overlayCanvasRef=e=>{e?(this.overlayCanvas=e,this.overlayCtx=this.overlayCanvas.getContext("2d"),this.renderCanvas()):(this.overlayCanvas=null,this.overlayCtx=null)};render(){const e=this.getStyle();return w("div",{ref:this.containerRef,onWheel:this.onWheel,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave,className:gn(e.minimap,En.vbox)},w("canvas",{width:1,height:1,ref:this.overlayCanvasRef,className:gn(e.fill)}))}}function go(e){const t=ro(Zt()),r=e.formatter(e.selectedTotal),i=e.formatter(e.selectedSelf),n=100*e.selectedTotal/e.grandTotal,o=100*e.selectedSelf/e.grandTotal;return w("div",{className:gn(t.statsTable)},w("div",{className:gn(e.cellStyle,t.statsTableCell,t.statsTableHeader)},e.title),w("div",{className:gn(e.cellStyle,t.statsTableCell)},"Total"),w("div",{className:gn(e.cellStyle,t.statsTableCell)},"Self"),w("div",{className:gn(e.cellStyle,t.statsTableCell)},r),w("div",{className:gn(e.cellStyle,t.statsTableCell)},i),w("div",{className:gn(e.cellStyle,t.statsTableCell)},D(n),w("div",{className:gn(t.barDisplay),style:{height:`${n}%`}})),w("div",{className:gn(e.cellStyle,t.statsTableCell)},D(o),w("div",{className:gn(t.barDisplay),style:{height:`${o}%`}})))}function _o(e){const t=ro(Zt()),r=[];let i=e.node;for(;i&&!i.isRoot();i=i.parent){const n=[],{frame:o}=i;if(n.push(w(zn,{color:e.getFrameColor(o)})),r.length&&n.push(w("span",{className:gn(t.stackFileLine)},"> ")),n.push(o.name),o.file){let e=o.file;null!=o.line&&(e+=`:${o.line}`,null!=o.col&&(e+=`:${o.col}`)),n.push(w("span",{className:gn(t.stackFileLine)}," (",e,")"))}r.push(w("div",{className:gn(t.stackLine)},n))}return w("div",{className:gn(t.stackTraceView)},w("div",{className:gn(t.stackTraceViewPadding)},r))}function wo(e){const t=ro(Zt()),{flamechart:r,selectedNode:i}=e,{frame:n}=i;return w("div",{className:gn(t.detailView)},w(go,{title:"This Instance",cellStyle:t.thisInstanceCell,grandTotal:r.getTotalWeight(),selectedTotal:i.getTotalWeight(),selectedSelf:i.getSelfWeight(),formatter:r.formatValue.bind(r)}),w(go,{title:"All Instances",cellStyle:t.allInstancesCell,grandTotal:r.getTotalWeight(),selectedTotal:n.getTotalWeight(),selectedSelf:n.getSelfWeight(),formatter:r.formatValue.bind(r)}),w(_o,{node:i,getFrameColor:e.getCSSColorForFrame}))}class vo{argsBatch=[];text(e){this.argsBatch.push(e)}fill(e,t){if(0!==this.argsBatch.length){e.fillStyle=t;for(let t of this.argsBatch)e.fillText(t.text,t.x,t.y);this.argsBatch=[]}}}class yo{argsBatch=[];rect(e){this.argsBatch.push(e)}drawPath(e){e.beginPath();for(let t of this.argsBatch)e.rect(t.x,t.y,t.w,t.h);e.closePath(),this.argsBatch=[]}fill(e,t){0!==this.argsBatch.length&&(e.fillStyle=t,this.drawPath(e),e.fill())}stroke(e,t,r){0!==this.argsBatch.length&&(e.strokeStyle=t,e.lineWidth=r,this.drawPath(e),e.stroke())}}class So extends S{container=null;containerRef=e=>{this.container=e||null};overlayCanvas=null;overlayCtx=null;hoveredLabel=null;getStyle(){return ro(this.props.theme)}setConfigSpaceViewportRect(e){this.props.setConfigSpaceViewportRect(e)}overlayCanvasRef=e=>{e?(this.overlayCanvas=e,this.overlayCtx=this.overlayCanvas.getContext("2d"),this.renderCanvas()):(this.overlayCanvas=null,this.overlayCtx=null)};configSpaceSize(){return new Q(this.props.flamechart.getTotalWeight(),this.props.flamechart.getLayers().length)}physicalViewSize(){return new Q(this.overlayCanvas?this.overlayCanvas.width:0,this.overlayCanvas?this.overlayCanvas.height:0)}physicalBounds(){if(this.props.renderInverted){const e=this.physicalViewSize().y,t=(this.configSpaceSize().y+1)*this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT*window.devicePixelRatio;if(t<e)return new ee(new Q(0,e-t),this.physicalViewSize())}return new ee(new Q(0,0),this.physicalViewSize())}LOGICAL_VIEW_SPACE_FRAME_HEIGHT=yn.FRAME_HEIGHT;configSpaceToPhysicalViewSpace(){return J.betweenRects(this.props.configSpaceViewportRect,this.physicalBounds())}logicalToPhysicalViewSpace(){return J.withScale(new Q(window.devicePixelRatio,window.devicePixelRatio))}resizeOverlayCanvasIfNeeded(){if(!this.overlayCanvas)return;let{width:e,height:t}=this.overlayCanvas.getBoundingClientRect();if(e=Math.floor(e),t=Math.floor(t),0===e||0===t)return;const r=e*window.devicePixelRatio,i=t*window.devicePixelRatio;r===this.overlayCanvas.width&&i===this.overlayCanvas.height||(this.overlayCanvas.width=r,this.overlayCanvas.height=i)}renderOverlays(){const e=this.overlayCtx;if(!e)return;if(this.props.configSpaceViewportRect.isEmpty())return;const t=this.configSpaceToPhysicalViewSpace(),r=wn.LABEL*window.devicePixelRatio,i=this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT*window.devicePixelRatio,n=this.physicalViewSize();e.clearRect(0,0,n.x,n.y),e.font=`${r}px/${i}px ${_n.MONOSPACE}`,e.textBaseline="alphabetic";const o=so(e,"MM"),s=(t.inverseTransformVector(new Q(o,0))||new Q(0,0)).x,a=5*window.devicePixelRatio,l=new vo,c=new vo,h=new yo,u=new yo,f=new yo,d=new yo,p=(u,f=0)=>{const d=u.end-u.start,m=this.props.renderInverted?this.configSpaceSize().y-1-f:f,g=new ee(new Q(u.start,m),new Q(d,1));if(!(d<s||g.left()>this.props.configSpaceViewportRect.right()||g.right()<this.props.configSpaceViewportRect.left())){if(this.props.renderInverted){if(g.bottom()<this.props.configSpaceViewportRect.top())return}else if(g.top()>this.props.configSpaceViewportRect.bottom())return;if(g.hasIntersectionWith(this.props.configSpaceViewportRect)){let s=t.transformRect(g);if(s.left()<0&&(s=s.withOrigin(s.origin.withX(0)).withSize(s.size.withX(s.size.x+s.left()))),s.right()>n.x&&(s=s.withSize(s.size.withX(n.x-s.left()))),s.width()>o){const t=this.props.searchResults?.getMatchForFrame(u.node.frame),n=lo(e,u.node.frame.name,s.width()-2*a);if(t){const o=uo(n,t);let l=0,c=s.left()+a;const u=(i-r)/2-2;for(let[t,r]of o){c+=so(e,n.trimmedString.substring(l,t));const o=so(e,n.trimmedString.substring(t,r));h.rect({x:c,y:s.top()+u,w:o,h:i-2*u}),c+=o,l=r}}(null==this.props.searchResults||t?l:c).text({text:n.trimmedString,x:s.left()+a,y:Math.round(s.bottom()-(i-r)/2)})}}for(let e of u.children)p(e,f+1)}},m=2*window.devicePixelRatio;e.strokeStyle=this.props.theme.selectionSecondaryColor;const g=(t.inverseTransformVector(new Q(1,0))||new Q(0,0)).x,_=(e,r=0)=>{if(!this.props.selectedNode&&null==this.props.searchResults)return;const i=e.end-e.start,n=this.props.renderInverted?this.configSpaceSize().y-1-r:r,o=new ee(new Q(e.start,n),new Q(i,1));if(!(i<g||o.left()>this.props.configSpaceViewportRect.right()||o.right()<this.props.configSpaceViewportRect.left()||o.top()>this.props.configSpaceViewportRect.bottom())){if(o.hasIntersectionWith(this.props.configSpaceViewportRect)){if(this.props.searchResults?.getMatchForFrame(e.node.frame)){const e=t.transformRect(o);d.rect({x:Math.round(e.left()+m/2),y:Math.round(e.top()+m/2),w:Math.round(Math.max(0,e.width()-m)),h:Math.round(Math.max(0,e.height()-m))})}if(null!=this.props.selectedNode&&e.node.frame===this.props.selectedNode.frame){let r=e.node===this.props.selectedNode?u:f;const i=t.transformRect(o);r.rect({x:Math.round(i.left()+1+m/2),y:Math.round(i.top()+1+m/2),w:Math.round(Math.max(0,i.width()-2-m)),h:Math.round(Math.max(0,i.height()-2-m))})}}for(let t of e.children)_(t,r+1)}};for(let e of this.props.flamechart.getLayers()[0]||[])_(e);for(let e of this.props.flamechart.getLayers()[0]||[])p(e);const w=this.props.theme;if(d.fill(e,w.searchMatchPrimaryColor),h.fill(e,w.searchMatchSecondaryColor),c.fill(e,w.fgSecondaryColor),l.fill(e,null!=this.props.searchResults?w.searchMatchTextColor:w.fgPrimaryColor),f.stroke(e,w.selectionSecondaryColor,m),u.stroke(e,w.selectionPrimaryColor,m),this.hoveredLabel){let r=w.fgPrimaryColor;this.props.selectedNode===this.hoveredLabel.node&&(r=w.selectionPrimaryColor),e.lineWidth=2*devicePixelRatio,e.strokeStyle=r;const i=t.transformRect(this.hoveredLabel.configSpaceBounds);e.strokeRect(Math.round(i.left()),Math.round(i.top()),Math.round(Math.max(0,i.width())),Math.round(Math.max(0,i.height())))}this.renderTimeIndicators()}renderTimeIndicators(){const e=this.overlayCtx;if(!e)return;const t=this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT*window.devicePixelRatio,r=this.physicalViewSize(),i=this.configSpaceToPhysicalViewSpace(),n=(t-wn.LABEL*window.devicePixelRatio)/2,o=this.props.configSpaceViewportRect.left(),s=this.props.configSpaceViewportRect.right(),a=(this.configSpaceToPhysicalViewSpace().inverted()||new J).times(this.logicalToPhysicalViewSpace()).transformVector(new Q(200,1)).x;let l=Math.pow(10,Math.floor(Math.log10(a)));a/l>5?l*=5:a/l>2&&(l*=2);const c=this.props.theme;{const a=this.props.renderInverted?r.y-t:0;e.fillStyle=he.fromCSSHex(c.bgPrimaryColor).withAlpha(.8).toCSS(),e.fillRect(0,a,r.x,t),e.textBaseline="top";for(let t=Math.ceil(o/l)*l;t<s;t+=l){const o=Math.round(i.transformPosition(new Q(t,0)).x),s=this.props.flamechart.formatValue(t),l=so(e,s);e.fillStyle=c.fgPrimaryColor,e.fillText(s,o-l-n,a+n),e.fillStyle=c.fgSecondaryColor,e.fillRect(o,0,1,r.y)}}}updateConfigSpaceViewport(){if(!this.container)return;const{logicalSpaceViewportSize:e}=this.props,t=this.container.getBoundingClientRect(),{width:r,height:i}=t;if(r<2||i<2)return;if(this.props.configSpaceViewportRect.isEmpty()){const e=i/this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT;this.props.renderInverted?this.setConfigSpaceViewportRect(new ee(new Q(0,this.configSpaceSize().y-e+1),new Q(this.configSpaceSize().x,e))):this.setConfigSpaceViewportRect(new ee(new Q(0,-1),new Q(this.configSpaceSize().x,e)))}else e.equals(Q.zero)||e.x===r&&e.y===i||this.setConfigSpaceViewportRect(this.props.configSpaceViewportRect.withSize(this.props.configSpaceViewportRect.size.timesPointwise(new Q(r/e.x,i/e.y))));const n=new Q(r,i);n.equals(e)||this.props.setLogicalSpaceViewportSize(n)}onWindowResize=()=>{this.updateConfigSpaceViewport(),this.onBeforeFrame()};renderRects(){this.container&&(this.updateConfigSpaceViewport(),this.props.configSpaceViewportRect.isEmpty()||this.props.canvasContext.renderBehind(this.container,(()=>{this.props.flamechartRenderer.render({physicalSpaceDstRect:this.physicalBounds(),configSpaceSrcRect:this.props.configSpaceViewportRect,renderOutlines:!0})})))}frameHadWheelEvent=!1;framesWithoutWheelEvents=0;interactionLock=null;maybeClearInteractionLock=()=>{this.interactionLock&&(this.frameHadWheelEvent||(this.framesWithoutWheelEvents++,this.framesWithoutWheelEvents>=2&&(this.interactionLock=null,this.framesWithoutWheelEvents=0)),this.props.canvasContext.requestFrame()),this.frameHadWheelEvent=!1};onBeforeFrame=()=>{this.resizeOverlayCanvasIfNeeded(),this.renderRects(),this.renderOverlays(),this.maybeClearInteractionLock()};renderCanvas=()=>{this.props.canvasContext.requestFrame()};pan(e){this.interactionLock="pan";const t=this.logicalToPhysicalViewSpace().transformVector(e),r=this.configSpaceToPhysicalViewSpace().inverseTransformVector(t);this.hoveredLabel&&this.props.onNodeHover(null),r&&this.props.transformViewport(J.withTranslation(r))}zoom(e,t){this.interactionLock="zoom";const r=this.logicalToPhysicalViewSpace().transformPosition(e),i=this.configSpaceToPhysicalViewSpace().inverseTransformPosition(r);if(!i)return;const n=J.withTranslation(i.times(-1)).scaledBy(new Q(t,1)).translatedBy(i);this.props.transformViewport(n)}lastDragPos=null;mouseDownPos=null;onMouseDown=e=>{this.mouseDownPos=this.lastDragPos=new Q(e.offsetX,e.offsetY),this.updateCursor(),window.addEventListener("mouseup",this.onWindowMouseUp)};onMouseDrag=e=>{if(!this.lastDragPos)return;const t=new Q(e.offsetX,e.offsetY);this.pan(this.lastDragPos.minus(t)),this.lastDragPos=t,this.hoveredLabel&&this.props.onNodeHover(null)};onDblClick=e=>{if(this.hoveredLabel){const e=this.hoveredLabel.configSpaceBounds,t=new ee(e.origin.minus(new Q(0,1)),e.size.withY(this.props.configSpaceViewportRect.height()));this.props.setConfigSpaceViewportRect(t)}};onClick=e=>{const t=new Q(e.offsetX,e.offsetY),r=this.mouseDownPos;this.mouseDownPos=null,r&&t.minus(r).length()>5||(this.hoveredLabel?(this.props.onNodeSelect(this.hoveredLabel.node),this.renderCanvas()):this.props.onNodeSelect(null))};updateCursor(){this.lastDragPos?(document.body.style.cursor="grabbing",document.body.style.cursor="-webkit-grabbing"):document.body.style.cursor="default"}onWindowMouseUp=e=>{this.lastDragPos=null,this.updateCursor(),window.removeEventListener("mouseup",this.onWindowMouseUp)};onMouseMove=e=>{if(this.updateCursor(),this.lastDragPos)return e.preventDefault(),void this.onMouseDrag(e);this.hoveredLabel=null;const t=new Q(e.offsetX,e.offsetY),r=this.logicalToPhysicalViewSpace().transformPosition(t),i=this.configSpaceToPhysicalViewSpace().inverseTransformPosition(r);if(!i)return;const n=(e,t=0)=>{const r=e.end-e.start,o=this.props.renderInverted?this.configSpaceSize().y-1-t:t,s=new ee(new Q(e.start,o),new Q(r,1));if(i.x<s.left())return null;if(i.x>s.right())return null;s.contains(i)&&(this.hoveredLabel={configSpaceBounds:s,node:e.node});for(let r of e.children)n(r,t+1)};for(let e of this.props.flamechart.getLayers()[0]||[])n(e);this.hoveredLabel?this.props.onNodeHover({node:this.hoveredLabel.node,event:e}):this.props.onNodeHover(null),this.renderCanvas()};onMouseLeave=e=>{this.hoveredLabel=null,this.props.onNodeHover(null),this.renderCanvas()};onWheel=e=>{e.preventDefault(),this.frameHadWheelEvent=!0;const t=e.metaKey||e.ctrlKey;let r=e.deltaY,i=e.deltaX;if(e.deltaMode===e.DOM_DELTA_LINE&&(r*=this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT,i*=this.LOGICAL_VIEW_SPACE_FRAME_HEIGHT),t&&"pan"!==this.interactionLock){let t=1+r/100;e.ctrlKey&&(t=1+r/40),t=Z(t,.1,10),this.zoom(new Q(e.offsetX,e.offsetY),t)}else"zoom"!==this.interactionLock&&this.pan(new Q(i,r));this.renderCanvas()};onWindowKeyPress=e=>{if(!this.container)return;const{width:t,height:r}=this.container.getBoundingClientRect();"="===e.key||"+"===e.key?(this.zoom(new Q(t/2,r/2),.5),e.preventDefault()):"-"!==e.key&&"_"!==e.key||(this.zoom(new Q(t/2,r/2),2),e.preventDefault()),e.ctrlKey||e.shiftKey||e.metaKey||("0"===e.key?this.zoom(new Q(t/2,r/2),1e9):"ArrowRight"===e.key||"KeyD"===e.code?this.pan(new Q(100,0)):"ArrowLeft"===e.key||"KeyA"===e.code?this.pan(new Q(-100,0)):"ArrowUp"===e.key||"KeyW"===e.code?this.pan(new Q(0,-100)):"ArrowDown"===e.key||"KeyS"===e.code?this.pan(new Q(0,100)):"Escape"===e.key&&(this.props.onNodeSelect(null),this.renderCanvas()))};shouldComponentUpdate(){return!1}componentWillReceiveProps(e){this.props.flamechart!==e.flamechart?(this.hoveredLabel=null,this.renderCanvas()):this.props.searchResults!==e.searchResults||this.props.selectedNode!==e.selectedNode||this.props.configSpaceViewportRect!==e.configSpaceViewportRect?this.renderCanvas():this.props.canvasContext!==e.canvasContext&&(this.props.canvasContext&&this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame),e.canvasContext&&(e.canvasContext.addBeforeFrameHandler(this.onBeforeFrame),e.canvasContext.requestFrame()))}componentDidMount(){this.props.canvasContext.addBeforeFrameHandler(this.onBeforeFrame),window.addEventListener("resize",this.onWindowResize),window.addEventListener("keydown",this.onWindowKeyPress)}componentWillUnmount(){this.props.canvasContext.removeBeforeFrameHandler(this.onBeforeFrame),window.removeEventListener("resize",this.onWindowResize),window.removeEventListener("keydown",this.onWindowKeyPress)}render(){const e=this.getStyle();return w("div",{className:gn(e.panZoomView,En.vbox),onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave,onClick:this.onClick,onDblClick:this.onDblClick,onWheel:this.onWheel,ref:this.containerRef},w("canvas",{width:1,height:1,ref:this.overlayCanvasRef,className:gn(e.fill)}))}}function xo(e){const t=Co(Zt()),{containerSize:r,offset:i}=e,n=r.x,o=r.y,s=ze((e=>{if(!e)return;const t=e.getBoundingClientRect();let r=i.x+7;r+t.width>n-1&&(r=n-t.width-1,r<1&&(r=1)),e.style.left=`${r}px`;let s=i.y+7;s+t.height>o-1&&(s=i.y-t.height-1,s<1&&(s=1)),e.style.top=`${s}px`}),[n,o,i.x,i.y]);return w("div",{className:gn(t.hoverTip),ref:s},w("div",{className:gn(t.hoverTipRow)},e.children))}const Co=Qt((e=>mn.create({hoverTip:{position:"absolute",background:e.bgPrimaryColor,border:"1px solid black",maxWidth:yn.TOOLTIP_WIDTH_MAX,paddingTop:2,paddingBottom:2,pointerEvents:"none",userSelect:"none",fontSize:wn.LABEL,fontFamily:_n.MONOSPACE,zIndex:Cn.HOVERTIP},hoverTipRow:{textOverflow:"ellipsis",whiteSpace:"nowrap",overflowX:"hidden",paddingLeft:2,paddingRight:2,maxWidth:yn.TOOLTIP_WIDTH_MAX}}))),Ro=k(null),Eo=({flamechart:e,selectedNode:t,setSelectedNode:r,configSpaceViewportRect:i,setConfigSpaceViewportRect:n,children:o})=>{const s=Ge(Pn),a=De((()=>null==s?null:new Ln(e,s)),[e,s]);return w(Ro.Provider,{value:{results:a,flamechart:e,selectedNode:t,setSelectedNode:r,configSpaceViewportRect:i,setConfigSpaceViewportRect:n}},o)},bo=Ze((()=>{const e=Ge(Ro),t=null==e?null:e.results,r=null==e?null:e.selectedNode,i=null==e?null:e.setSelectedNode,n=null==e?null:e.configSpaceViewportRect,o=null==e?null:e.setConfigSpaceViewportRect,s=null==e?null:e.flamechart,a=null==t?null:t.count(),l=De((()=>null==t||null==r?null:t.indexOf(r)),[t,r]),c=ze((e=>{if(!i)return;if(!s)return;if(!n)return;if(!o)return;const t=e.configSpaceBounds,r=new ee(t.origin.minus(new Q(0,1)),t.size.withY(n.height()));i(e.node),o(s.getClampedConfigSpaceViewportRect({configSpaceViewportRect:r}))}),[n,o,i,s]),{selectPrev:h,selectNext:u}=De((()=>null==a||0===a||null==t?{selectPrev:()=>{},selectNext:()=>{}}:{selectPrev:()=>{if(!t?.at)return;if(null==a||0===a)return;let e=null==l?a-1:l-1;e<0&&(e=a-1);const r=t.at(e);c(r)},selectNext:()=>{if(!t?.at)return;if(null==a||0===a)return;let e=null==l?0:l+1;e>=a&&(e=0);const r=t.at(e);c(r)}}),[a,l,t,c]);return w(On,{resultIndex:l,numResults:a,selectPrev:h,selectNext:u})}));class To extends S{}class Ao extends To{getStyle(){return ro(this.props.theme)}configSpaceSize(){return new Q(this.props.flamechart.getTotalWeight(),this.props.flamechart.getLayers().length)}setConfigSpaceViewportRect=e=>{const t=yn.DETAIL_VIEW_HEIGHT/yn.FRAME_HEIGHT,r=this.configSpaceSize(),i=this.props.flamechart.getClampedViewportWidth(e.size.x),n=e.size.withX(i),o=Q.clamp(e.origin,new Q(0,-1),Q.max(Q.zero,r.minus(n).plus(new Q(0,t+1))));this.props.setConfigSpaceViewportRect(new ee(o,e.size.withX(i)))};setLogicalSpaceViewportSize=e=>{this.props.setLogicalSpaceViewportSize(e)};transformViewport=e=>{const t=e.transformRect(this.props.configSpaceViewportRect);this.setConfigSpaceViewportRect(t)};onNodeHover=e=>{this.props.setNodeHover(e)};onNodeClick=e=>{this.props.setSelectedNode(e)};formatValue(e){const t=D(100*e/this.props.flamechart.getTotalWeight());return`${this.props.flamechart.formatValue(e)} (${t})`}renderTooltip(){if(!this.container)return null;const{hover:e}=this.props;if(!e)return null;const{width:t,height:r,left:i,top:n}=this.container.getBoundingClientRect(),o=new Q(e.event.clientX-i,e.event.clientY-n),s=e.node.frame,a=this.getStyle();return w(xo,{containerSize:new Q(t,r),offset:o},w("span",{className:gn(a.hoverCount)},this.formatValue(e.node.frame.getTotalWeight()))," ",s.name,s.file?w("div",null,s.file,":",s.line):void 0)}container=null;containerRef=e=>{this.container=e||null};render(){const e=this.getStyle();return w("div",{className:gn(e.fill,En.vbox),ref:this.containerRef},w(mo,{theme:this.props.theme,configSpaceViewportRect:this.props.configSpaceViewportRect,transformViewport:this.transformViewport,flamechart:this.props.flamechart,flamechartRenderer:this.props.flamechartRenderer,canvasContext:this.props.canvasContext,setConfigSpaceViewportRect:this.setConfigSpaceViewportRect}),w(Pn.Consumer,null,(e=>w(y,null,w(So,{theme:this.props.theme,canvasContext:this.props.canvasContext,flamechart:this.props.flamechart,flamechartRenderer:this.props.flamechartRenderer,renderInverted:!1,onNodeHover:this.onNodeHover,onNodeSelect:this.onNodeClick,selectedNode:this.props.selectedNode,transformViewport:this.transformViewport,configSpaceViewportRect:this.props.configSpaceViewportRect,setConfigSpaceViewportRect:this.setConfigSpaceViewportRect,logicalSpaceViewportSize:this.props.logicalSpaceViewportSize,setLogicalSpaceViewportSize:this.setLogicalSpaceViewportSize,searchResults:e}),w(bo,null)))),this.renderTooltip(),this.props.selectedNode&&w(wo,{flamechart:this.props.flamechart,getCSSColorForFrame:this.props.getCSSColorForFrame,selectedNode:this.props.selectedNode}))}}function Lo(e){return{setNodeHover:ze((t=>{Ct.setFlamechartHoveredNode(e,t)}),[e]),setLogicalSpaceViewportSize:ze((t=>{Ct.setLogicalSpaceViewportSize(e,t)}),[e]),setConfigSpaceViewportRect:ze((t=>{Ct.setConfigSpaceViewportRect(e,t)}),[e]),setSelectedNode:ze((t=>{Ct.setSelectedNode(e,t)}),[e])}}const Fo=$((({profile:e,getColorBucketForFrame:t})=>new Zn({getTotalWeight:e.getTotalWeight.bind(e),forEachCall:e.forEachCall.bind(e),formatValue:e.formatValue.bind(e),getColorBucketForFrame:t}))),Po=e=>$((({canvasContext:t,flamechart:r})=>new to(t.gl,Ce(t),r,t.rectangleBatchRenderer,t.flamechartColorPassRenderer,e))),No=Po(),Oo=Ze((e=>{const{activeProfileState:t,glCanvas:r}=e,{profile:i,chronoViewState:n}=t,o=Zt(),s=xe({theme:o,canvas:r}),a=Ee(i),l=ye(a),c=Se({theme:o,frameToColorBucket:a}),h=Fo({profile:i,getColorBucketForFrame:l}),u=No({canvasContext:s,flamechart:h}),f=Lo(gt.CHRONO);return w(Eo,{flamechart:h,selectedNode:n.selectedNode,setSelectedNode:f.setSelectedNode,configSpaceViewportRect:n.configSpaceViewportRect,setConfigSpaceViewportRect:f.setConfigSpaceViewportRect},w(Ao,{theme:o,renderInverted:!1,flamechart:h,flamechartRenderer:u,canvasContext:s,getCSSColorForFrame:c,...n,...f}))})),Io=$((({profile:e,getColorBucketForFrame:t})=>new Zn({getTotalWeight:e.getTotalNonIdleWeight.bind(e),forEachCall:e.forEachCallGrouped.bind(e),formatValue:e.formatValue.bind(e),getColorBucketForFrame:t}))),Mo=Po(),Vo=Ze((e=>{const{activeProfileState:t,glCanvas:r}=e,{profile:i,leftHeavyViewState:n}=t,o=Zt(),s=xe({theme:o,canvas:r}),a=Ee(i),l=ye(a),c=Se({theme:o,frameToColorBucket:a}),h=Io({profile:i,getColorBucketForFrame:l}),u=Mo({canvasContext:s,flamechart:h}),f=Lo(gt.LEFT_HEAVY);return w(Eo,{flamechart:h,selectedNode:n.selectedNode,setSelectedNode:f.setSelectedNode,configSpaceViewportRect:n.configSpaceViewportRect,setConfigSpaceViewportRect:f.setConfigSpaceViewportRect},w(Ao,{theme:o,renderInverted:!1,flamechart:h,flamechartRenderer:u,canvasContext:s,getCSSColorForFrame:c,...n,...f}))}));class ko extends To{clampViewportToFlamegraph(e){const{flamechart:t,renderInverted:r}=this.props;return t.getClampedConfigSpaceViewportRect({configSpaceViewportRect:e,renderInverted:r})}setConfigSpaceViewportRect=e=>{this.props.setConfigSpaceViewportRect(this.clampViewportToFlamegraph(e))};setLogicalSpaceViewportSize=e=>{this.props.setLogicalSpaceViewportSize(e)};transformViewport=e=>{this.setConfigSpaceViewportRect(e.transformRect(this.props.configSpaceViewportRect))};formatValue(e){const t=D(100*e/this.props.flamechart.getTotalWeight());return`${this.props.flamechart.formatValue(e)} (${t})`}renderTooltip(){if(!this.container)return null;const{hover:e}=this.props;if(!e)return null;const{width:t,height:r,left:i,top:n}=this.container.getBoundingClientRect(),o=new Q(e.event.clientX-i,e.event.clientY-n),s=Wo(this.props.theme),a=e.node.frame;return w(xo,{containerSize:new Q(t,r),offset:o},w("span",{className:gn(s.hoverCount)},this.formatValue(e.node.getTotalWeight()))," ",a.name,a.file?w("div",null,a.file,":",a.line):void 0)}container=null;containerRef=e=>{this.container=e||null};setNodeHover=e=>{this.props.setNodeHover(e)};render(){return w("div",{className:gn(En.fillY,En.fillX,En.vbox),ref:this.containerRef},w(So,{theme:this.props.theme,selectedNode:null,onNodeHover:this.setNodeHover,onNodeSelect:U,configSpaceViewportRect:this.props.configSpaceViewportRect,setConfigSpaceViewportRect:this.setConfigSpaceViewportRect,transformViewport:this.transformViewport,flamechart:this.props.flamechart,flamechartRenderer:this.props.flamechartRenderer,canvasContext:this.props.canvasContext,renderInverted:this.props.renderInverted,logicalSpaceViewportSize:this.props.logicalSpaceViewportSize,setLogicalSpaceViewportSize:this.setLogicalSpaceViewportSize,searchResults:null}),this.renderTooltip())}}const Wo=Qt((e=>mn.create({hoverCount:{color:e.weightColor}}))),Bo=$((({profile:e,frame:t,flattenRecursion:r})=>{let i=e.getInvertedProfileForCallersOf(t);return r?i.getProfileWithRecursionFlattened():i})),Ho=$((({invertedCallerProfile:e,getColorBucketForFrame:t})=>new Zn({getTotalWeight:e.getTotalNonIdleWeight.bind(e),forEachCall:e.forEachCallGrouped.bind(e),formatValue:e.formatValue.bind(e),getColorBucketForFrame:t}))),Do=Po({inverted:!0}),zo=Ze((e=>{const{activeProfileState:t}=e;let{profile:r,sandwichViewState:i}=t;const n=dt(vt),o=dt(bt),s=Zt();if(!r)throw new Error("profile missing");if(!o)throw new Error("glCanvas missing");const{callerCallee:a}=i;if(!a)throw new Error("callerCallee missing");const{selectedFrame:l}=a,c=Ee(r),h=ye(c),u=Se({theme:s,frameToColorBucket:c}),f=xe({theme:s,canvas:o}),d=Ho({invertedCallerProfile:Bo({profile:r,frame:l,flattenRecursion:n}),getColorBucketForFrame:h}),p=Do({canvasContext:f,flamechart:d});return w(ko,{theme:s,renderInverted:!0,flamechart:d,flamechartRenderer:p,canvasContext:f,getCSSColorForFrame:u,...Lo(gt.SANDWICH_INVERTED_CALLERS),...a.invertedCallerFlamegraph,setSelectedNode:U})})),Go=$((({profile:e,frame:t,flattenRecursion:r})=>{let i=e.getProfileForCalleesOf(t);return r?i.getProfileWithRecursionFlattened():i})),Uo=$((({calleeProfile:e,getColorBucketForFrame:t})=>new Zn({getTotalWeight:e.getTotalNonIdleWeight.bind(e),forEachCall:e.forEachCallGrouped.bind(e),formatValue:e.formatValue.bind(e),getColorBucketForFrame:t}))),jo=Po(),$o=Ze((e=>{const{activeProfileState:t}=e,{profile:r,sandwichViewState:i}=t,n=dt(vt),o=dt(bt),s=Zt();if(!r)throw new Error("profile missing");if(!o)throw new Error("glCanvas missing");const{callerCallee:a}=i;if(!a)throw new Error("callerCallee missing");const{selectedFrame:l}=a,c=Ee(r),h=ye(c),u=Se({theme:s,frameToColorBucket:c}),f=xe({theme:s,canvas:o}),d=Uo({calleeProfile:Go({profile:r,frame:l,flattenRecursion:n}),getColorBucketForFrame:h}),p=jo({canvasContext:f,flamechart:d});return w(ko,{theme:s,renderInverted:!1,flamechart:d,flamechartRenderer:p,canvasContext:f,getCSSColorForFrame:u,...Lo(gt.SANDWICH_CALLEES),...a.calleeFlamegraph,setSelectedNode:U})})),Ko=Ze((()=>{const e=Ge(qo),t=null!=e?e.rowList:null,r=null!=e?.selectedFrame?e.getIndexForFrame(e.selectedFrame):null,i=null!=t?t.length:null,{selectPrev:n,selectNext:o}=De((()=>null==t||null==i||0===i||null==e?{selectPrev:()=>{},selectNext:()=>{}}:{selectPrev:()=>{let n=null==r?i-1:r-1;n<0&&(n=i-1),e.setSelectedFrame(t[n])},selectNext:()=>{let n=null==r?0:r+1;n>=i&&(n=0),e.setSelectedFrame(t[n])}}),[r,t,i,e]);return w(On,{resultIndex:r,numResults:i,selectPrev:n,selectNext:o})}));class Yo extends To{setSelectedFrame=e=>{this.props.setSelectedFrame(e)};onWindowKeyPress=e=>{"Escape"===e.key&&this.setSelectedFrame(null)};componentDidMount(){window.addEventListener("keydown",this.onWindowKeyPress)}componentWillUnmount(){window.removeEventListener("keydown",this.onWindowKeyPress)}render(){const e=Xo(this.props.theme),{selectedFrame:t}=this.props;let r=null;return t&&(r=w("div",{className:gn(En.fillY,e.callersAndCallees,En.vbox)},w("div",{className:gn(En.hbox,e.panZoomViewWraper)},w("div",{className:gn(e.flamechartLabelParent)},w("div",{className:gn(e.flamechartLabel)},"Callers")),w(zo,{glCanvas:this.props.glCanvas,activeProfileState:this.props.activeProfileState})),w("div",{className:gn(e.divider)}),w("div",{className:gn(En.hbox,e.panZoomViewWraper)},w("div",{className:gn(e.flamechartLabelParent,e.flamechartLabelParentBottom)},w("div",{className:gn(e.flamechartLabel,e.flamechartLabelBottom)},"Callees")),w($o,{glCanvas:this.props.glCanvas,activeProfileState:this.props.activeProfileState})))),w("div",{className:gn(En.hbox,En.fillY)},w("div",{className:gn(e.tableView)},w(qn,{activeProfileState:this.props.activeProfileState}),w(Ko,null)),r)}}const Xo=Qt((e=>mn.create({tableView:{position:"relative",flex:1},panZoomViewWraper:{flex:1},flamechartLabelParent:{display:"flex",flexDirection:"column",justifyContent:"flex-end",alignItems:"flex-start",fontSize:wn.TITLE,width:1.2*wn.TITLE,borderRight:`1px solid ${e.fgSecondaryColor}`},flamechartLabelParentBottom:{justifyContent:"flex-start"},flamechartLabel:{transform:"rotate(-90deg)",transformOrigin:"50% 50% 0",width:1.2*wn.TITLE,flexShrink:1},flamechartLabelBottom:{transform:"rotate(-90deg)",display:"flex",justifyContent:"flex-end"},callersAndCallees:{flex:1,borderLeft:`${yn.SEPARATOR_HEIGHT}px solid ${e.fgSecondaryColor}`},divider:{height:2,background:e.fgSecondaryColor}}))),qo=k(null),Zo=Ze((e=>{const{activeProfileState:t,glCanvas:r}=e,{sandwichViewState:i,index:n}=t,{callerCallee:o}=i,s=Zt(),a=ze((e=>{Ct.setSelectedFrame(e)}),[]),l=t.profile,c=dt(Vt),h=Ge(Pn),u=o?o.selectedFrame:null,f=De((()=>{const e=[];switch(l.forEachFrame((t=>{h&&!h.getMatchForFrame(t)||e.push(t)})),c.field){case Nt.SYMBOL_NAME:B(e,(e=>e.name.toLowerCase()));break;case Nt.SELF:B(e,(e=>e.getSelfWeight()));break;case Nt.TOTAL:B(e,(e=>e.getTotalWeight()))}return c.direction===It.DESCENDING&&e.reverse(),e}),[l,h,c]),d=De((()=>{const e=new Map;for(let t=0;t<f.length;t++)e.set(f[t],t);return t=>{const r=e.get(t);return null==r?null:r}}),[f]),p=De((()=>e=>null==h?null:h.getMatchForFrame(e)),[h]),m={rowList:f,selectedFrame:u,setSelectedFrame:a,getIndexForFrame:d,getSearchMatchForFrame:p};return w(qo.Provider,{value:m},w(Yo,{theme:s,activeProfileState:t,glCanvas:r,setSelectedFrame:a,selectedFrame:u,profileIndex:n}))}));function Qo(e){if(console.log(e),!e.children)return new Hn(0);const t=e.children.reduce(((e,t)=>t.total_samples+e),0),r=new Hn(t);return r.setName("a"),function e(t,i){t.frame=Wn.getOrInsert(r.frames,{color_key:i.item?.code_type??"",key:i.item?.name??"",name:i.item?.name??"(unk)"}),t.frame.addToSelfWeight(i.self_samples),t.frame.addToTotalWeight(i.total_samples),i.total_samples>0&&(r.samples.push(t),r.weights.push(i.self_samples));for(let r of i.children??[]){e(new Bn(Wn.root,t),r)}return t}(new Bn(Wn.root,null),e),r}o("l3kj8").then((()=>{})),o("1wbBj").then((()=>{}));class Jo extends To{canvas=null;ref=e=>{e instanceof HTMLCanvasElement?this.canvas=e:this.canvas=null,this.props.setGLCanvas(this.canvas)};container=null;containerRef=e=>{e instanceof HTMLElement?this.container=e:this.container=null};maybeResize=()=>{if(!this.container)return;if(!this.props.canvasContext)return;let{width:e,height:t}=this.container.getBoundingClientRect();const r=e,i=t,n=e*window.devicePixelRatio,o=t*window.devicePixelRatio;this.props.canvasContext.gl.resize(n,o,r,i)};onWindowResize=()=>{this.props.canvasContext&&this.props.canvasContext.requestFrame()};componentWillReceiveProps(e){this.props.canvasContext!==e.canvasContext&&(this.props.canvasContext&&this.props.canvasContext.removeBeforeFrameHandler(this.maybeResize),e.canvasContext&&(e.canvasContext.addBeforeFrameHandler(this.maybeResize),e.canvasContext.requestFrame()))}componentDidMount(){window.addEventListener("resize",this.onWindowResize)}componentWillUnmount(){this.props.canvasContext&&this.props.canvasContext.removeBeforeFrameHandler(this.maybeResize),window.removeEventListener("resize",this.onWindowResize)}render(){const e=ts(this.props.theme);return w("div",{ref:this.containerRef,className:gn(e.glCanvasView)},w("canvas",{ref:this.ref,width:1,height:1}))}}class es extends To{async loadProfile(e){if(await new Promise((e=>setTimeout(e,0))),!this.props.glCanvas)return;console.time("import");let t=null;try{t=await e()}catch(e){return console.log("Failed to load format",e),void this.props.setError(!0)}if(null==t)return void alert("Unrecognized format! See documentation about supported formats.");if(null===t.profile)return void alert("Successfully imported profile, but it's empty!");this.props.hashParams.title&&(t={...t,name:this.props.hashParams.title}),document.title=`${t.name} - speedscope`;const r=this.props.hashParams.title||t.profile.getName();t.profile.setName(r),console.timeEnd("import"),this.props.setProfileGroup(t)}getStyle(){return ts(this.props.theme)}loadSample(){var e=async()=>{let e=await fetch("/sample.json"),t=Qo(await e.json());return console.log(t),{name:"default",profile:t}};console.log("test"),this.loadProfile(e);const t=new EventSource("/api/events");console.log(t),t.onmessage=t=>{this.loadProfile(e)}}loadFromApi(e){var t=async()=>{let t=await fetch(e??"/api/current"),r=Qo(await t.json());return console.log(r),{name:"default",profile:r}};this.loadProfile(t);const r=new EventSource("/api/events");console.log(r),r.onmessage=e=>{console.log(e),this.loadProfile(t)}}onWindowKeyPress=async e=>{if("1"===e.key)this.props.setViewMode(ut.CHRONO_FLAME_CHART);else if("2"===e.key)this.props.setViewMode(ut.LEFT_HEAVY_FLAME_GRAPH);else if("3"===e.key)this.props.setViewMode(ut.SANDWICH_VIEW);else if("r"===e.key){const{flattenRecursion:e}=this.props;this.props.setFlattenRecursion(!e)}else"n"===e.key||e.key};onWindowKeyDown=async e=>{("s"===e.key&&(e.ctrlKey||e.metaKey)||"o"===e.key&&(e.ctrlKey||e.metaKey))&&e.preventDefault()};componentDidMount(){window.addEventListener("keydown",this.onWindowKeyDown),window.addEventListener("keypress",this.onWindowKeyPress),this.load()}componentWillUnmount(){window.removeEventListener("keydown",this.onWindowKeyDown),window.removeEventListener("keypress",this.onWindowKeyPress)}load(){const e=window.location.search,t=new URLSearchParams(e).get("profileURL");return null!==t?this.loadFromApi(t):this.loadFromApi()}renderLanding(){const e=this.getStyle();return w("div",{className:gn(e.landingContainer)},w("div",{className:gn(e.landingMessage)}))}renderError(){const e=this.getStyle();return w("div",{className:gn(e.error)},w("div",null," Something went wrong."),w("div",null,"Check the JS console for more details."))}renderLoadingBar(){const e=this.getStyle();return w("div",{className:gn(e.loading)})}renderContent(){const{viewMode:e,activeProfileState:t,error:r,loading:i,glCanvas:n}=this.props;if(r)return this.renderError();if(i)return this.renderLoadingBar();if(!t||!n)return this.renderLanding();switch(e){case ut.CHRONO_FLAME_CHART:return w(Oo,{activeProfileState:t,glCanvas:n});case ut.LEFT_HEAVY_FLAME_GRAPH:return w(Vo,{activeProfileState:t,glCanvas:n});case ut.SANDWICH_VIEW:return w(Zo,{activeProfileState:t,glCanvas:n})}}render(){const e=this.getStyle();return w("div",{className:gn(e.root,this.props.dragActive&&e.dragTargetRoot)},w(Jo,{setGLCanvas:this.props.setGLCanvas,canvasContext:this.props.canvasContext,theme:this.props.theme}),w("div",{className:gn(e.contentContainer)},this.renderContent()),this.props.dragActive&&w("div",{className:gn(e.dragTarget)}))}}const ts=Qt((e=>mn.create({glCanvasView:{position:"absolute",width:"100vw",height:"100vh",zIndex:-1,pointerEvents:"none"},error:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%"},loading:{height:3,marginBottom:-3,background:e.selectionPrimaryColor,transformOrigin:"0% 50%",animationName:[{from:{transform:"scaleX(0)"},to:{transform:"scaleX(1)"}}],animationTimingFunction:"cubic-bezier(0, 1, 0, 1)",animationDuration:"30s"},root:{width:"100vw",height:"100vh",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative",fontFamily:_n.MONOSPACE,lineHeight:"20px",color:e.fgPrimaryColor},dragTargetRoot:{cursor:"copy"},dragTarget:{boxSizing:"border-box",position:"absolute",top:0,left:0,width:"100%",height:"100%",border:`5px dashed ${e.selectionPrimaryColor}`,pointerEvents:"none"},contentContainer:{position:"relative",display:"flex",overflow:"hidden",flexDirection:"column",flex:1},landingContainer:{display:"flex",alignItems:"center",justifyContent:"center",flex:1},landingMessage:{maxWidth:600},landingP:{marginBottom:16},hide:{display:"none"},browseButtonContainer:{display:"flex",alignItems:"center",justifyContent:"center"},browseButton:{marginBottom:16,height:72,flex:1,maxWidth:256,textAlign:"center",fontSize:wn.BIG_BUTTON,lineHeight:"72px",background:e.selectionPrimaryColor,color:e.altFgPrimaryColor,transition:`all ${xn.HOVER_CHANGE} ease-in`,":hover":{background:e.selectionSecondaryColor}},link:{color:e.selectionPrimaryColor,cursor:"pointer",textDecoration:"none",transition:`all ${xn.HOVER_CHANGE} ease-in`,":hover":{color:e.selectionSecondaryColor}}}))),rs=Ze((()=>{const e=dt(bt),t=Zt(),r=De((()=>e?xe({theme:t,canvas:e}):null),[t,e]);return w(Nn,null,w(es,{activeProfileState:kt(),canvasContext:r,setGLCanvas:bt.set,setLoading:Ft.set,setError:Pt.set,setProfileGroup:Ct.setProfileGroup,setDragActive:Tt.set,setViewMode:xt.set,setFlattenRecursion:vt.set,setProfileIndexToView:Ct.setProfileIndexToView,profileGroup:dt(Ct),theme:t,flattenRecursion:dt(vt),viewMode:dt(xt),hashParams:dt(Et),glCanvas:e,dragActive:dt(Tt),loading:dt(Ft),error:dt(Pt)}))}));console.log(`speedscope v${o("8LNmT").version}`),V(w((function(e){const[t,r]=Ve((()=>Jt().matches)),i=ze((e=>{r(e.matches)}),[r]);We((()=>{const e=Jt();return e.addEventListener("change",i),()=>{e.removeEventListener("change",i)}}),[i]);const n=function(e,t){switch(e){case Wt.SYSTEM:return t?$t:Xt;case Wt.DARK:return $t;case Wt.LIGHT:return Xt}}(dt(zt),t);return w(qt.Provider,{value:n,children:e.children})}),null,w(rs,null)),document.body,document.body.lastElementChild||void 0);
//# sourceMappingURL=app.c8d29fc3.js.map
